var Ss=Object.defineProperty;var xs=(t,e,n)=>e in t?Ss(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var ct=(t,e,n)=>xs(t,typeof e!="symbol"?e+"":e,n);import{E as nt,F as oe,al as Is,am as zs,an as hn,D as pn,M as qe,N as re,O as gn,P as yn,S as Ct,U as Bs,R as bn,ao as vn,K as se,ap as Wt,g as Ue,a4 as ks,H as Cs,I as Ms,J as Qe,L as Ie,aq as wn,ar as As,as as pe,at as ge,au as tn,Z as Es,av as en,aw as Sn,ax as Ts,Q as xn,ay as Os,az as ze,W as _s,aA as In,aB as Ps,aC as zn,aD as Ns,aE as Rs,aF as qs,a6 as Bn,t as kn,aG as Ls,aH as Ds,aI as Hs,aJ as nn,aK as Js,T as $,b as Z,V as js,e as X,w as it,q as v,aL as Cn,p as Ys,i as It,m as Y,n as F,k as bt,l as Fs,j as sn,aM as W,s as H}from"./nKfqrTNe.js";import"./Bzak7iHL.js";import{i as $s}from"./CLEP_dGz.js";import{p as Xt,i as Et,a as Zs,s as Xs}from"./CkPp-hAN.js";function mr(t,e,n){nt&&oe();var s=t,i=Bs,a,r,o=null,l=Is()?zs:hn;function c(){a&&bn(a),o!==null&&(o.lastChild.remove(),s.before(o),o=null),a=r}pn(()=>{if(l(i,i=e())){var d=s,f=yn();f&&(o=document.createDocumentFragment(),o.append(d=qe())),r=re(()=>n(d)),f?gn.add_callback(c):c()}}),nt&&(s=Ct)}function hr(t,e){return e}function Vs(t,e,n){for(var s=t.items,i=[],a=e.length,r=0;r<a;r++)Ns(e[r].e,i,!0);var o=a>0&&i.length===0&&n!==null;if(o){var l=n.parentNode;Rs(l),l.append(n),s.clear(),yt(t,e[0].prev,e[a-1].next)}qs(i,()=>{for(var c=0;c<a;c++){var d=e[c];o||(s.delete(d.k),yt(t,d.prev,d.next)),In(d.e,!o)}})}function pr(t,e,n,s,i,a=null){var r=t,o={flags:e,items:new Map,first:null},l=(e&vn)!==0;if(l){var c=t;r=nt?se(Wt(c)):c.appendChild(qe())}nt&&oe();var d=null,f=!1,u=new Map,b=ks(()=>{var g=n();return Ts(g)?g:g==null?[]:Sn(g)}),m,y;function p(){Ws(y,m,o,u,r,i,e,s,n),a!==null&&(m.length===0?d?xn(d):d=re(()=>a(r)):d!==null&&bn(d,()=>{d=null}))}pn(()=>{y??(y=Bn),m=Ue(b);var g=m.length;if(f&&g===0)return;f=g===0;let h=!1;if(nt){var w=Cs(r)===Ms;w!==(g===0)&&(r=Qe(),se(r),Ie(!1),h=!0)}if(nt){for(var M=null,A,S=0;S<g;S++){if(Ct.nodeType===wn&&Ct.data===As){r=Ct,h=!0,Ie(!1);break}var I=m[S],_=s(I,S);A=_e(Ct,o,M,null,I,_,S,i,e,n),o.items.set(_,A),M=A}g>0&&se(Qe())}if(nt)g===0&&a&&(d=re(()=>a(r)));else if(yn()){var ut=new Set,Q=gn;for(S=0;S<g;S+=1){I=m[S],_=s(I,S);var ot=o.items.get(_)??u.get(_);ot?(e&(pe|ge))!==0&&Mn(ot,I,S,e):(A=_e(null,o,null,null,I,_,S,i,e,n,!0),u.set(_,A)),ut.add(_)}for(const[B,D]of o.items)ut.has(B)||Q.skipped_effects.add(D.e);Q.add_callback(p)}else p();h&&Ie(!0),Ue(b)}),nt&&(r=Ct)}function Ws(t,e,n,s,i,a,r,o,l){var Pt,rt,Nt,at;var c=(r&Ps)!==0,d=(r&(pe|ge))!==0,f=e.length,u=n.items,b=n.first,m=b,y,p=null,g,h=[],w=[],M,A,S,I;if(c)for(I=0;I<f;I+=1)M=e[I],A=o(M,I),S=u.get(A),S!==void 0&&((Pt=S.a)==null||Pt.measure(),(g??(g=new Set)).add(S));for(I=0;I<f;I+=1){if(M=e[I],A=o(M,I),S=u.get(A),S===void 0){var _=s.get(A);if(_!==void 0){s.delete(A),u.set(A,_);var ut=p?p.next:m;yt(n,p,_),yt(n,_,ut),Be(_,ut,i),p=_}else{var Q=m?m.e.nodes_start:i;p=_e(Q,n,p,p===null?n.first:p.next,M,A,I,a,r,l)}u.set(A,p),h=[],w=[],m=p.next;continue}if(d&&Mn(S,M,I,r),(S.e.f&ze)!==0&&(xn(S.e),c&&((rt=S.a)==null||rt.unfix(),(g??(g=new Set)).delete(S))),S!==m){if(y!==void 0&&y.has(S)){if(h.length<w.length){var ot=w[0],B;p=ot.prev;var D=h[0],O=h[h.length-1];for(B=0;B<h.length;B+=1)Be(h[B],ot,i);for(B=0;B<w.length;B+=1)y.delete(w[B]);yt(n,D.prev,O.next),yt(n,p,D),yt(n,O,ot),m=ot,p=O,I-=1,h=[],w=[]}else y.delete(S),Be(S,m,i),yt(n,S.prev,S.next),yt(n,S,p===null?n.first:p.next),yt(n,p,S),p=S;continue}for(h=[],w=[];m!==null&&m.k!==A;)(m.e.f&ze)===0&&(y??(y=new Set)).add(m),w.push(m),m=m.next;if(m===null)continue;S=m}h.push(S),p=S,m=S.next}if(m!==null||y!==void 0){for(var et=y===void 0?[]:Sn(y);m!==null;)(m.e.f&ze)===0&&et.push(m),m=m.next;var V=et.length;if(V>0){var Zt=(r&vn)!==0&&f===0?i:null;if(c){for(I=0;I<V;I+=1)(Nt=et[I].a)==null||Nt.measure();for(I=0;I<V;I+=1)(at=et[I].a)==null||at.fix()}Vs(n,et,Zt)}}c&&_s(()=>{var Rt;if(g!==void 0)for(S of g)(Rt=S.a)==null||Rt.apply()}),t.first=n.first&&n.first.e,t.last=p&&p.e;for(var ht of s.values())In(ht.e);s.clear()}function Mn(t,e,n,s){(s&pe)!==0&&tn(t.v,e),(s&ge)!==0?tn(t.i,n):t.i=n}function _e(t,e,n,s,i,a,r,o,l,c,d){var f=(l&pe)!==0,u=(l&Os)===0,b=f?u?Es(i,!1,!1):en(i):i,m=(l&ge)===0?r:en(r),y={i:m,v:b,k:a,a:null,e:null,prev:n,next:s};try{if(t===null){var p=document.createDocumentFragment();p.append(t=qe())}return y.e=re(()=>o(t,b,m,c),nt),y.e.prev=n&&n.e,y.e.next=s&&s.e,n===null?d||(e.first=y):(n.next=y,n.e.next=y.e),s!==null&&(s.prev=y,s.e.prev=y.e),y}finally{}}function Be(t,e,n){for(var s=t.next?t.next.e.nodes_start:n,i=e?e.e.nodes_start:n,a=t.e.nodes_start;a!==null&&a!==s;){var r=zn(a);i.before(a),a=r}}function yt(t,e,n){e===null?t.first=n:(e.next=n,e.e.next=n&&n.e),n!==null&&(n.prev=e,n.e.prev=e&&e.e)}function G(t,e,n=!1,s=!1,i=!1){var a=t,r="";kn(()=>{var o=Bn;if(r===(r=e()??"")){nt&&oe();return}if(o.nodes_start!==null&&(Ls(o.nodes_start,o.nodes_end),o.nodes_start=o.nodes_end=null),r!==""){if(nt){Ct.data;for(var l=oe(),c=l;l!==null&&(l.nodeType!==wn||l.data!=="");)c=l,l=zn(l);if(l===null)throw Ds(),Hs;nn(Ct,c),a=se(l);return}var d=r+"";n?d=`<svg>${d}</svg>`:s&&(d=`<math>${d}</math>`);var f=Js(d);if((n||s)&&(f=Wt(f)),nn(Wt(f),f.lastChild),n||s)for(;Wt(f);)a.before(Wt(f));else a.before(f)}})}function K(t,e,n){$(()=>{var s=Z(()=>e(t,n==null?void 0:n())||{});if(n&&(s!=null&&s.update)){var i=!1,a={};js(()=>{var r=n();X(r),i&&hn(a,r)&&(a=r,s.update(r))}),i=!0}if(s!=null&&s.destroy)return()=>s.destroy()})}function An(t){var e,n,s="";if(typeof t=="string"||typeof t=="number")s+=t;else if(typeof t=="object")if(Array.isArray(t)){var i=t.length;for(e=0;e<i;e++)t[e]&&(n=An(t[e]))&&(s&&(s+=" "),s+=n)}else for(n in t)t[n]&&(s&&(s+=" "),s+=n);return s}function Gs(){for(var t,e,n=0,s="",i=arguments.length;n<i;n++)(t=arguments[n])&&(e=An(t))&&(s&&(s+=" "),s+=e);return s}function gr(t){return typeof t=="object"?Gs(t):t??""}const on=[...` 	
\r\fÂ \v\uFEFF`];function Ks(t,e,n){var s=t==null?"":""+t;if(e&&(s=s?s+" "+e:e),n){for(var i in n)if(n[i])s=s?s+" "+i:i;else if(s.length)for(var a=i.length,r=0;(r=s.indexOf(i,r))>=0;){var o=r+a;(r===0||on.includes(s[r-1]))&&(o===s.length||on.includes(s[o]))?s=(r===0?"":s.substring(0,r))+s.substring(o+1):r=o}}return s===""?null:s}function rn(t,e=!1){var n=e?" !important;":";",s="";for(var i in t){var a=t[i];a!=null&&a!==""&&(s+=" "+i+": "+a+n)}return s}function ke(t){return t[0]!=="-"||t[1]!=="-"?t.toLowerCase():t}function Us(t,e){if(e){var n="",s,i;if(Array.isArray(e)?(s=e[0],i=e[1]):s=e,t){t=String(t).replaceAll(/\s*\/\*.*?\*\/\s*/g,"").trim();var a=!1,r=0,o=!1,l=[];s&&l.push(...Object.keys(s).map(ke)),i&&l.push(...Object.keys(i).map(ke));var c=0,d=-1;const y=t.length;for(var f=0;f<y;f++){var u=t[f];if(o?u==="/"&&t[f-1]==="*"&&(o=!1):a?a===u&&(a=!1):u==="/"&&t[f+1]==="*"?o=!0:u==='"'||u==="'"?a=u:u==="("?r++:u===")"&&r--,!o&&a===!1&&r===0){if(u===":"&&d===-1)d=f;else if(u===";"||f===y-1){if(d!==-1){var b=ke(t.substring(c,d).trim());if(!l.includes(b)){u!==";"&&f++;var m=t.substring(c,f).trim();n+=" "+m+";"}}c=f+1,d=-1}}}}return s&&(n+=rn(s)),i&&(n+=rn(i,!0)),n=n.trim(),n===""?null:n}return t==null?null:String(t)}function Qs(t,e,n,s,i,a){var r=t.__className;if(nt||r!==n||r===void 0){var o=Ks(n,s,a);(!nt||o!==t.getAttribute("class"))&&(o==null?t.removeAttribute("class"):e?t.className=o:t.setAttribute("class",o)),t.__className=n}else if(a&&i!==a)for(var l in a){var c=!!a[l];(i==null||c!==!!i[l])&&t.classList.toggle(l,c)}return a}function Ce(t,e={},n,s){for(var i in n){var a=n[i];e[i]!==a&&(n[i]==null?t.style.removeProperty(i):t.style.setProperty(i,a,s))}}function ti(t,e,n,s){var i=t.__style;if(nt||i!==e){var a=Us(e,s);(!nt||a!==t.getAttribute("style"))&&(a==null?t.removeAttribute("style"):t.style.cssText=a),t.__style=e}else s&&(Array.isArray(s)?(Ce(t,n==null?void 0:n[0],s[0]),Ce(t,n==null?void 0:n[1],s[1],"important")):Ce(t,n,s));return s}function ei(t){const e=document.createElement("div");return e.textContent=t,Object.assign(e.style,{position:"fixed",zIndex:"10000",pointerEvents:"none",background:"rgba(60,60,60,0.95)",color:"#fff",padding:"4px 8px",borderRadius:"4px",fontSize:"12px",lineHeight:"1",boxShadow:"0 2px 8px rgba(0,0,0,0.25)",whiteSpace:"nowrap",opacity:"0",transform:"translateY(-2px)",transition:"opacity 80ms ease, transform 80ms ease"}),e}function ie(t,e,n,s,i){const a=t.getBoundingClientRect(),r=e.getBoundingClientRect(),o=window.innerWidth,l=window.innerHeight,c={top:a.top-s-r.height>=0,bottom:a.bottom+s+r.height<=l,left:a.left-s-r.width>=0,right:a.right+s+r.width<=o};let d=n;if(n==="auto")c.right?d="right":c.bottom?d="bottom":c.left?d="left":d="top";else if(n==="right"&&!c.right||n==="bottom"&&!c.bottom||n==="left"&&!c.left||n==="top"&&!c.top)return ie(t,e,"auto",s);let f=0,u=0;if(d==="right"?(f=a.top+a.height/2-r.height/2,u=a.right+s):d==="left"?(f=a.top+a.height/2-r.height/2,u=a.left-r.width-s):d==="bottom"?(f=a.bottom+s,u=a.left+a.width/2-r.width/2):(f=a.top-r.height-s,u=a.left+a.width/2-r.width/2),u=Math.max(4,Math.min(u,o-r.width-4)),f=Math.max(4,Math.min(f,l-r.height-4)),e.style.top=`${f}px`,e.style.left=`${u}px`,i){const m=getComputedStyle(e).backgroundColor||"rgba(60,60,60,0.95)";Object.assign(i.style,{background:m,width:"8px",height:"8px",position:"absolute",transform:"rotate(45deg)",pointerEvents:"none",boxShadow:"0 2px 8px rgba(0,0,0,0.15)"}),i.style.top="",i.style.bottom="",i.style.left="",i.style.right="",d==="right"?(i.style.top="50%",i.style.left=`${-8/2}px`,i.style.transform="translateY(-50%) rotate(45deg)"):d==="left"?(i.style.top="50%",i.style.right=`${-8/2}px`,i.style.transform="translateY(-50%) rotate(45deg)"):d==="bottom"?(i.style.top=`${-8/2}px`,i.style.left="50%",i.style.transform="translateX(-50%) rotate(45deg)"):(i.style.bottom=`${-8/2}px`,i.style.left="50%",i.style.transform="translateX(-50%) rotate(45deg)")}}function z(t,e){if(typeof window>"u")return{};let n=typeof e=="string"?e:e.content,s=typeof e=="string"?"auto":e.placement??"auto",i=typeof e=="string"?8:e.offset??8,a=typeof e=="string"?200:e.delay??200,r=null,o=null,l=null;function c(){r||!n||(r=ei(n),o=document.createElement("div"),r.appendChild(o),document.body.appendChild(r),ie(t,r,s,i,o),requestAnimationFrame(()=>{r&&(r.style.opacity="1",r.style.transform="translateY(0)")}))}function d(){if(!r)return;const m=r;r=null,o=null,m.style.opacity="0",m.style.transform="translateY(-2px)",setTimeout(()=>{m.remove()},120)}function f(){l&&window.clearTimeout(l),l=window.setTimeout(c,a)}function u(){l&&window.clearTimeout(l),l=null,d()}function b(){r&&ie(t,r,s,i,o||void 0)}return t.addEventListener("mouseenter",f),t.addEventListener("mouseleave",u),t.addEventListener("focus",f),t.addEventListener("blur",u),t.addEventListener("pointermove",b),{update(m){n=typeof m=="string"?m:m.content,s=typeof m=="string"?"auto":m.placement??"auto",i=typeof m=="string"?8:m.offset??8,a=typeof m=="string"?200:m.delay??200,r&&(r.textContent=n,o||(o=document.createElement("div"),r.appendChild(o)),ie(t,r,s,i,o))},destroy(){t.removeEventListener("mouseenter",f),t.removeEventListener("mouseleave",u),t.removeEventListener("focus",f),t.removeEventListener("blur",u),t.removeEventListener("pointermove",b),l&&window.clearTimeout(l),d()}}}const En="timelineData";function ni(){if(typeof localStorage>"u")return[];try{const t=localStorage.getItem(En);return t?JSON.parse(t):[]}catch{return[]}}function si(t){typeof localStorage>"u"||localStorage.setItem(En,JSON.stringify(t))}const gt=it(ni());gt.subscribe(si);const Yt={subscribe:gt.subscribe,add(t){gt.update(e=>e.some(n=>n.id===t.id)?e:[...e,t])},update(t){gt.update(e=>e.map(n=>n.id===t.id?t:n))},getById(t){return v(gt).find(e=>e.id===t)},remove(t){gt.update(e=>e.filter(n=>n.id!==t))},getAll(){return v(gt)},addCue(t,e){var r;const n=v(gt).find(o=>o.id===t);if(!n)return;const s=e.id??"cue-"+Math.random().toString(36).slice(2),i=((r=e.name)==null?void 0:r.trim())||void 0;if(i&&(n.cuePoints??[]).some(l=>{var c,d;return(((d=(c=l.name)==null?void 0:c.toLowerCase)==null?void 0:d.call(c))||"").trim()===i.toLowerCase()}))throw new Error(`Cue name "${i}" already exists in timeline.`);const a={...n,cuePoints:[...n.cuePoints??[],{id:s,time:e.time,name:i}].sort((o,l)=>o.time-l.time)};this.update(a)},renameCue(t,e,n){const s=v(gt).find(o=>o.id===t);if(!s)return;const i=(n||"").trim();if(!i)return;if((s.cuePoints??[]).some(o=>{var l,c;return o.id!==e&&(((c=(l=o.name)==null?void 0:l.toLowerCase)==null?void 0:c.call(l))||"").trim()===i.toLowerCase()}))throw new Error(`Cue name "${i}" already exists in timeline.`);const r={...s,cuePoints:(s.cuePoints??[]).map(o=>o.id===e?{...o,name:i}:o)};this.update(r)},deleteCue(t,e){const n=v(gt).find(i=>i.id===t);if(!n)return;const s={...n,cuePoints:(n.cuePoints??[]).filter(i=>i.id!==e)};this.update(s)}},Le=it(null);class ii{constructor(e){ct(this,"id");ct(this,"duration");ct(this,"loopEnabled");ct(this,"cuePoints");ct(this,"rafId",null);ct(this,"playing",!1);ct(this,"startTime",0);ct(this,"current",0);ct(this,"lastTick",0);ct(this,"loopCount",0);ct(this,"listeners",new Set);ct(this,"tick",()=>{if(!this.playing)return;const e=performance.now(),n=this.current,s=e-this.startTime;let i=s,a=!1;if(s>=this.duration)if(this.loopEnabled&&this.duration>0)i=s%this.duration,a=!0;else{i=this.duration,this.current=i;const o=e-this.lastTick;this.emit({type:"tick",time:this.current,dt:o}),this.emitCues(n,i,a),this.pause();return}this.current=i;const r=e-this.lastTick;this.lastTick=e,this.emit({type:"tick",time:this.current,dt:r}),this.emitCues(n,i,a),a&&this.emit({type:"loop",count:++this.loopCount}),this.rafId=requestAnimationFrame(this.tick)});this.id=e.id,this.duration=Math.max(0,e.duration),this.loopEnabled=!!e.loop,this.cuePoints=[...e.cuePoints??[]].sort((n,s)=>n.time-s.time)}on(e){this.listeners.add(e)}off(e){this.listeners.delete(e)}emit(e){for(const n of this.listeners)n(e)}get time(){return this.current}get durationMs(){return this.duration}get isPlaying(){return this.playing}get isLooping(){return this.loopEnabled}setLoop(e){this.loopEnabled=e}setDuration(e){if(this.duration,this.duration=Math.max(0,Math.floor(e)),this.current>this.duration)this.seek(this.duration);else if(this.playing){const n=performance.now();this.startTime=n-this.current}}play(){if(this.playing)return;this.playing=!0;const e=performance.now();this.startTime=e-this.current,this.lastTick=e,this.emit({type:"play"}),this.tick()}pause(){this.playing&&(this.playing=!1,this.rafId!==null&&cancelAnimationFrame(this.rafId),this.rafId=null,this.emit({type:"pause"}))}stop(){const e=this.playing;this.playing=!1,this.rafId!==null&&cancelAnimationFrame(this.rafId),this.rafId=null,this.current=0,this.loopCount=0,e&&this.emit({type:"stop"})}seek(e){const n=Math.max(0,Math.min(this.duration,Math.floor(e)));if(this.current=n,this.playing){const s=performance.now();this.startTime=s-this.current,this.lastTick=s}this.emit({type:"seek",time:this.current})}emitCues(e,n,s){if(this.cuePoints.length!==0)if(s)for(const i of this.cuePoints)i.time>e&&i.time<=this.duration&&this.emit({type:"cue",cue:i}),i.time>=0&&i.time<=n&&this.emit({type:"cue",cue:i});else for(const i of this.cuePoints)i.time>e&&i.time<=n&&this.emit({type:"cue",cue:i})}}const qt=new Map,yr={get(t){return qt.get(t)},create(t){let e=qt.get(t.id);return e||(e=new ii({...t}),qt.set(t.id,e),e)},delete(t){const e=qt.get(t);e&&(e.stop(),qt.delete(t))},all(){return Array.from(qt.values())}},Tn=it([]);function oi(){return"n_"+Math.random().toString(36).slice(2,10)}function On(t,e={}){const n={id:oi(),type:e.type??"info",message:t,ts:Date.now(),ttl:e.ttl??4e3};return Tn.update(s=>[n,...s]),n.ttl&&setTimeout(()=>ri(n.id),n.ttl),n.id}function ri(t){Tn.update(e=>e.filter(n=>n.id!==t))}function ai(){On("Locked element cannot be added to multi-selection",{type:"warn"})}function li(){On("Element is hidden (visibility off)",{type:"info",ttl:2500})}const _n=1;function q(t){return typeof structuredClone=="function"?structuredClone(t):JSON.parse(JSON.stringify(t))}function dt(t){return typeof t=="object"&&t!==null}function ye(t){return Array.isArray(t)}function be(t){return typeof t=="string"}function ci(t){return typeof t=="number"&&Number.isFinite(t)}function di(t){return dt(t)&&be(t.id)&&ye(t.elements)&&dt(t.layouts)&&dt(t.metadata)}function fi(t){return dt(t)&&be(t.id)&&ye(t.pages)&&dt(t.metadata)}function ui(t){return dt(t)&&be(t.id)&&ye(t.lessons)&&dt(t.metadata)}function mi(t){return dt(t)&&be(t.id)&&ye(t.modules)&&dt(t.metadata)}function hi(t){if(!dt(t))return{error:"Root not object",migrated:!1};let e=t.projectVersion;return e==null&&(e=1,t.projectVersion=1),ci(e)?e>_n?{error:"Project version newer than runtime",migrated:!1}:{data:t,migrated:e!==t.projectVersion}:{error:"Invalid projectVersion",migrated:!1}}function Pn(t){const e=hi(t);if(e.error)return{ok:!1,error:e.error,migrated:!1};const n=e.data;if(!mi(n.course))return{ok:!1,error:"Invalid course",migrated:!1};if(!dt(n.modulesById))return{ok:!1,error:"modulesById missing",migrated:!1};if(!dt(n.lessonsById))return{ok:!1,error:"lessonsById missing",migrated:!1};if(!dt(n.pagesById))return{ok:!1,error:"pagesById missing",migrated:!1};for(const i of n.course.modules)if(!n.modulesById[i.id])return{ok:!1,error:`Dangling module ref ${i.id}`,migrated:!1};for(const i of Object.values(n.modulesById)){const a=i;if(!ui(a))return{ok:!1,error:`Invalid module ${a&&a.id}`};for(const r of a.lessons)if(!n.lessonsById[r.id])return{ok:!1,error:`Dangling lesson ref ${r.id}`}}for(const i of Object.values(n.lessonsById)){const a=i;if(!fi(a))return{ok:!1,error:`Invalid lesson ${a&&a.id}`};for(const r of a.pages)if(!n.pagesById[r.id])return{ok:!1,error:`Dangling page ref ${r.id}`}}for(const i of Object.values(n.pagesById)){const a=i;if(!di(a))return{ok:!1,error:`Invalid page ${a&&a.id}`}}return{ok:!0,data:q(n),migrated:e.migrated}}let Mt=null;const Nn="studioProjectData";let an=typeof Worker<"u";function pi(){if(!(!an||Mt))try{Mt=new Worker(new URL(""+new URL("../workers/autosave.worker-DaFSbAqs.js",import.meta.url).href,import.meta.url),{type:"module"});const t=v(x);Mt.postMessage({type:"init",key:Nn,full:t}),Mt.onmessage=e=>{const n=e.data;if(n.type==="persist-request")try{localStorage.setItem(n.key,JSON.stringify(n.data))}catch{}else if(n.type==="loaded")try{const s=JSON.parse(n.raw),i=Pn(s);i.ok&&i.data&&x.set(i.data)}catch{}}}catch{an=!1}}function gi(t){if(pi(),Mt)Mt.postMessage({type:"change",...t});else try{const e=v(x);t.pages&&Object.assign(e.pagesById,t.pages),t.lessons&&Object.assign(e.lessonsById,t.lessons),t.modules&&Object.assign(e.modulesById,t.modules),t.course&&(e.course=t.course),localStorage.setItem(Nn,JSON.stringify(e))}catch{}}function ln(){Mt&&Mt.postMessage({type:"flush"})}typeof window<"u"&&typeof document<"u"&&(document.addEventListener("visibilitychange",()=>{document.hidden&&ln()}),window.addEventListener("beforeunload",()=>{try{ln()}catch{}}));const Rn="timelineClips";function yi(){if(typeof localStorage>"u")return{};try{const t=localStorage.getItem(Rn);return t?JSON.parse(t):{}}catch{return{}}}function bi(t){typeof localStorage>"u"||localStorage.setItem(Rn,JSON.stringify(t))}const vt=it(yi());vt.subscribe(bi);const _t={subscribe:vt.subscribe,getForTimeline(t){return v(vt)[t]??[]},setForTimeline(t,e){vt.update(n=>(n[t]=e.map(s=>({...s})),n))},getMaxEnd(t){return(v(vt)[t]??[]).reduce((n,s)=>Math.max(n,s.end),0)},ensureClip(t,e,n){let s=this.getForTimeline(t).find(i=>i.elementId===e);if(s){if(s.start===0&&s.end===0&&n>0){const i={...s,end:Math.max(0,n)};vt.update(a=>{const r=a[t]??(a[t]=[]),o=r.findIndex(l=>l.id===i.id);return o>=0&&(r[o]=i),a}),s=i}return s}return s={id:"clip-"+Math.random().toString(36).slice(2),elementId:e,start:0,end:Math.max(0,n)},vt.update(i=>((i[t]??(i[t]=[])).push(s),i)),s},upsert(t,e){vt.update(n=>{const s=n[t]??(n[t]=[]),i=s.findIndex(a=>a.id===e.id);return i>=0?s[i]=e:s.push(e),n})},remove(t,e){vt.update(n=>{const s=n[t]??(n[t]=[]),i=s.findIndex(a=>a.id===e);return i>=0&&s.splice(i,1),n})}},Ut=it("page");function Ft(t=100){return{past:[],future:[],limit:t}}const vi=300,Lt=new Set,ae=new Set;function qn(t){Lt.has(t)||(j(t,"transform"),Lt.add(t))}function Ln(t){Lt.has(t)&&(Lt.delete(t),ae.has(t)&&(ae.delete(t),j(t,"transform",{forceTransform:!0})))}const le={},ce={},de={},fe={},ue={},wt=Ft(30);function mt(t,e){gi({scope:t,...e,ts:Date.now()})}const Me={},Vt={},cn={},dn={},Ae={},fn={};function Dn(t){var n,s,i,a;const e=[t.metadata.updatedAt,t.backgroundColor,t.elements.length];for(const r of t.elements){let o="";try{o=r.style?JSON.stringify(r.style):""}catch{o=""}e.push(r.id,r.position.x,r.position.y,(s=(n=r.size)==null?void 0:n.dimensions)==null?void 0:s.width,(a=(i=r.size)==null?void 0:i.dimensions)==null?void 0:a.height,r.rotation,r.opacity,r.visible?1:0,r.zIndex,o)}return e.join("|")}function wi(t){return t.pages.map(e=>e.id+":"+e.order).join(",")+"|"+t.metadata.updatedAt}function Si(t){return t.lessons.map(e=>e.id+":"+e.order).join(",")+"|"+t.metadata.updatedAt}function Hn(t){const e=_t.getForTimeline(t.id).map(s=>`${s.id}:${Math.floor(s.start)}-${Math.floor(s.end)}`).sort().join("|"),n=(t.cuePoints??[]).map(s=>s.id+":"+Math.floor(s.time)+":"+(s.name||"")).sort().join(",");return[t.id,Math.floor(t.duration),t.loop?1:0,n,e].join("|")}function xi(t,e){return Dn(t)+"||"+Hn(e)}function Ii(t){const e=v(L),n=t??v(Le);if(!e||!n)return null;const i=v(x).pagesById[e];if(!i)return null;const a=Yt.getById(n);if(!a)return null;const r=_t.getForTimeline(n).map(o=>({...o}));return{pageId:e,timelineId:n,page:q(i),timeline:q(a),clips:r}}function Jn(t,e,n){const s=Ii(n);if(!s)return;const i=xi(s.page,s.timeline);if(fn[s.pageId]===i)return;const a=ue[s.pageId]??(ue[s.pageId]=Ft());$t(a,s,e),fn[s.pageId]=i}function $t(t,e,n){const s=Date.now(),i=t.past[t.past.length-1];n!=="transform"&&n!=="style"&&i&&i.category===n&&s-i.ts<vi?(i.data=e,i.ts=s):(t.past.push({data:e,category:n,ts:s}),t.past.length>t.limit&&t.past.splice(0,t.past.length-t.limit)),t.future=[]}function zi(t,e){if(!t||t.elements.length!==e.elements.length)return"structure";for(let o=0;o<t.elements.length;o++)if(t.elements[o].id!==e.elements[o].id)return"structure";let n=!1,s=!1;for(let o=0;o<e.elements.length;o++){const l=t.elements[o],c=e.elements[o];if(l===c)continue;if(l.id!==c.id||l.type!==c.type)return"structure";const d=["position","size","rotation","opacity","visible","zIndex"];let f=!1;for(const u of d)if(JSON.stringify(l[u])!==JSON.stringify(c[u])){f=!0;break}if(f&&(n=!0),JSON.stringify(l.style)!==JSON.stringify(c.style)&&(s=!0),JSON.stringify(l.triggers)!==JSON.stringify(c.triggers)||JSON.stringify(l.animations)!==JSON.stringify(c.animations))return"structure"}const i=JSON.stringify(t.metadata)!==JSON.stringify(e.metadata),a=t.backgroundColor!==e.backgroundColor,r=JSON.stringify(t.layouts)!==JSON.stringify(e.layouts);return i&&!s&&!n&&!a&&!r?"meta":(a||r||s)&&!n?"style":n&&!s&&!i||n&&s?"transform":i?"meta":"structure"}function Bi(t,e){if(!t||t.pages.length!==e.pages.length)return"structure";for(let n=0;n<t.pages.length;n++)if(t.pages[n].id!==e.pages[n].id||t.pages[n].order!==e.pages[n].order)return"structure";return JSON.stringify(t.metadata)!==JSON.stringify(e.metadata)?"meta":"structure"}function ki(t,e){if(!t||t.lessons.length!==e.lessons.length)return"structure";for(let n=0;n<t.lessons.length;n++)if(t.lessons[n].id!==e.lessons[n].id||t.lessons[n].order!==e.lessons[n].order)return"structure";return JSON.stringify(t.metadata)!==JSON.stringify(e.metadata)?"meta":"structure"}const Gt=new Set,Pe=new Set,Ne={};function Ci(t){if(Gt.has(t))return;j(t,"structure");const n=v(x).pagesById[t];n&&(Ne[t]=q(n)),Gt.add(t)}function Mi(t){if(Gt.has(t)&&(Gt.delete(t),Pe.has(t))){Pe.delete(t);const n=v(x).pagesById[t],s=Ne[t];let i="structure";if(s&&n){let r=s.elements.length===n.elements.length;if(r){for(let o=0;o<s.elements.length;o++)if(s.elements[o].id!==n.elements[o].id){r=!1;break}}if(r){let o=!0;const l=["position","size","rotation","opacity","visible","zIndex"];for(let c=0;c<s.elements.length&&o;c++){const d=s.elements[c],f=n.elements[c];if(d.id!==f.id){o=!1;break}if(JSON.stringify(d.style)!==JSON.stringify(f.style)){o=!1;break}if(JSON.stringify(d.triggers)!==JSON.stringify(f.triggers)||JSON.stringify(d.animations)!==JSON.stringify(f.animations)){o=!1;break}for(const u of l)JSON.stringify(d[u]),JSON.stringify(f[u])}o&&(i="transform")}}delete Ne[t],j(t,i,{forceIsolation:!0})}}function j(t,e,n){var d;const i=v(x).pagesById[t];if(!i)return;const a=ls(t),r=Dn(i);if(e==="transform"&&Lt.has(t)&&!(n!=null&&n.forceTransform)){Vt[t]!==r&&ae.add(t);return}if(Gt.has(t)&&!(n!=null&&n.forceIsolation)){Vt[t]!==r&&Pe.add(t);return}if(Me[t]===a&&Vt[t]===r)return;if(v(Ut)==="stage"){Jn("page",e??"structure"),Me[t]=a,Vt[t]=r;return}const o=le[t]??(le[t]=Ft()),l=(d=o.past[o.past.length-1])==null?void 0:d.data,c=e??zi(l,i);console.log(`Committing page change for ${t} with category: ${c}`),$t(o,q(i),c),console.log(`Snapshot pushed for ${t}. Current stack length: ${o.past.length}`),Me[t]=a,Vt[t]=r,mt("page",{pages:{[t]:i}})}function Dt(t,e){var l;const s=v(x).lessonsById[t];if(!s)return;const i=wi(s);if(cn[t]===i)return;const a=ce[t]??(ce[t]=Ft()),r=(l=a.past[a.past.length-1])==null?void 0:l.data,o=Bi(r,s);$t(a,q(s),o),cn[t]=i,mt("lesson",{lessons:{[t]:s}})}function Ht(t,e){var l;const s=v(x).modulesById[t];if(!s)return;const i=Si(s);if(dn[t]===i)return;const a=de[t]??(de[t]=Ft()),r=(l=a.past[a.past.length-1])==null?void 0:l.data,o=ki(r,s);$t(a,q(s),o),dn[t]=i,mt("module",{modules:{[t]:s}})}function De(){const t=v(x),e={modulesOrder:q(t.course.modules),modulesById:q(t.modulesById)};$t(wt,e,"structure"),mt("module",{modules:e.modulesById,course:{modules:e.modulesOrder}})}function br(){const t=v(Ut);return t==="page"?Ai():t==="lesson"?Ti():t==="module"?_i():t==="timeline"?Ni():qi()}function vr(){const t=v(Ut);return t==="page"?Ei():t==="lesson"?Oi():t==="module"?Pi():t==="timeline"?Ri():Li()}function Ai(){const t=v(L);if(!t)return;const e=le[t];if(!e||e.past.length<2)return;const n=e.past.pop();n&&e.future.push(n);const s=e.past[e.past.length-1];s&&(x.update(i=>(i.pagesById[t]=q(s.data),i)),mt("page",{pages:{[t]:s.data}}))}function Ei(){const t=v(L);if(!t)return;const e=le[t];if(!e||e.future.length===0)return;const n=e.future.pop();x.update(s=>(s.pagesById[t]=q(n.data),s)),e.past.push(n),mt("page",{pages:{[t]:n.data}})}function Ti(){const t=v(st);if(!t)return;const e=ce[t];if(!e||e.past.length<2)return;const n=e.past.pop();n&&e.future.push(n);const s=e.past[e.past.length-1];s&&(x.update(i=>(i.lessonsById[t]=q(s.data),i)),mt("lesson",{lessons:{[t]:s.data}}))}function Oi(){const t=v(st);if(!t)return;const e=ce[t];if(!e||e.future.length===0)return;const n=e.future.pop();x.update(s=>(s.lessonsById[t]=q(n.data),s)),e.past.push(n),mt("lesson",{lessons:{[t]:n.data}})}function _i(){if(wt.past.length>1){v(x);const i=wt.past.pop();i&&wt.future.push(i);const a=wt.past[wt.past.length-1];if(!a)return;x.update(r=>(r.course.modules=q(a.data.modulesOrder),r.modulesById=q(a.data.modulesById),r)),mt("module",{modules:a.data.modulesById,course:{modules:a.data.modulesOrder}});return}const t=v(ft);if(!t)return;const e=de[t];if(!e||e.past.length<2)return;const n=e.past.pop();n&&e.future.push(n);const s=e.past[e.past.length-1];s&&(x.update(i=>(i.modulesById[t]=q(s.data),i)),mt("module",{modules:{[t]:s.data}}))}function Pi(){if(wt.future.length>0){const s=wt.future.pop();x.update(i=>(i.course.modules=q(s.data.modulesOrder),i.modulesById=q(s.data.modulesById),i)),wt.past.push(s),mt("module",{modules:s.data.modulesById,course:{modules:s.data.modulesOrder}});return}const t=v(ft);if(!t)return;const e=de[t];if(!e||e.future.length===0)return;const n=e.future.pop();x.update(s=>(s.modulesById[t]=q(n.data),s)),e.past.push(n),mt("module",{modules:{[t]:n.data}})}function wr(t,e="timeline"){const n=Yt.getById(t);if(!n)return;const s=Hn(n);if(Ae[t]===s)return;if(v(Ut)==="stage"){Jn("timeline",e,t),Ae[t]=s;return}const i=fe[t]??(fe[t]=Ft()),a={...n,__clips:_t.getForTimeline(t).map(r=>({...r}))};$t(i,a,e),Ae[t]=s}function Ni(){const t=v(Le);if(!t)return;const e=fe[t];if(!e||e.past.length<2)return;const n=e.past.pop();n&&e.future.push(n);const s=e.past[e.past.length-1];if(!s)return;Yt.update(s.data);const i=s.data.__clips;i&&_t.setForTimeline(t,i)}function Ri(){const t=v(Le);if(!t)return;const e=fe[t];if(!e||e.future.length===0)return;const n=e.future.pop();Yt.update(n.data);const s=n.data.__clips;s&&_t.setForTimeline(t,s),e.past.push(n)}function qi(){const t=v(L);if(!t)return;const e=ue[t];if(!e||e.past.length<2)return;const n=e.past.pop();n&&e.future.push(n);const s=e.past[e.past.length-1];s&&(x.update(i=>(i.pagesById[s.data.pageId]=q(s.data.page),i)),Yt.update(q(s.data.timeline)),_t.setForTimeline(s.data.timelineId,q(s.data.clips)))}function Li(){const t=v(L);if(!t)return;const e=ue[t];if(!e||e.future.length===0)return;const n=e.future.pop();x.update(s=>(s.pagesById[n.data.pageId]=q(n.data.page),s)),Yt.update(q(n.data.timeline)),_t.setForTimeline(n.data.timelineId,q(n.data.clips)),e.past.push(n)}function Sr(t){Ut.set(t)}const jn="studioIdCounters";let Tt={m:0,l:0,p:0,e:0};function Di(){if(!(typeof window>"u"))try{const t=localStorage.getItem(jn);if(t){const e=JSON.parse(t);e&&(Tt={...Tt,...e})}}catch{}}function Yn(){if(!(typeof window>"u"))try{localStorage.setItem(jn,JSON.stringify(Tt))}catch{}}function Fn(t){Di();const e=(n,s,i)=>{if(!n.startsWith(i))return;const a=n.slice(i.length),r=parseInt(a,36);!isNaN(r)&&r>Tt[s]&&(Tt[s]=r)};for(const n of Object.keys(t.modulesById))e(n,"m","m_");for(const n of Object.keys(t.lessonsById))e(n,"l","l_");for(const n of Object.keys(t.pagesById))e(n,"p","p_");Yn()}function ve(t){return Tt[t]+=1,Yn(),Tt[t].toString(36)}const $n=()=>`m_${ve("m")}`,Zn=()=>`l_${ve("l")}`,Xn=()=>`p_${ve("p")}`,He=()=>`e_${ve("e")}`,Vn="studioSpatialSettings",ee={enabled:!0,cellSize:128,threshold:80};function Hi(){if(typeof window>"u")return ee;try{const t=localStorage.getItem(Vn);if(!t)return ee;const e=JSON.parse(t);return{...ee,...e}}catch{return ee}}const Wn=it(Hi());typeof window<"u"&&Wn.subscribe(t=>{try{localStorage.setItem(Vn,JSON.stringify(t))}catch{}});const Gn="studioVisibilitySettings",ne={enabled:!0,margin:120};function Ji(){if(typeof window>"u")return ne;try{const t=localStorage.getItem(Gn);if(!t)return ne;const e=JSON.parse(t);return{...ne,...e}}catch{return ne}}const Kn=it(Ji());typeof window<"u"&&Kn.subscribe(t=>{try{localStorage.setItem(Gn,JSON.stringify(t))}catch{}});function Un(){return{spatial:{builds:0,lastBuildMs:0,totalBuildMs:0,avgBuildMs:0,lastPageId:null,lastElements:0,lastCells:0,adaptations:0,lastAdaptReason:null,lastAdaptFrom:null,lastAdaptTo:null},transforms:{frames:0,lastFlushMs:0,totalFlushMs:0,avgFlushMs:0,lastAppliedCount:0,totalApplied:0},queries:{rectCount:0,pointCount:0,hitTestCount:0,lastRectCandidates:0,totalRectCandidates:0,avgRectCandidates:0,lastHitTestCandidates:0,totalHitTestCandidates:0,avgHitTestCandidates:0}}}const zt=it(Un()),ji=Cn(zt,t=>t);function me(){return typeof performance<"u"&&performance.now?performance.now():Date.now()}function Yi(){zt.set(Un())}function Fi(){return v(zt)}function $i(t,e,n,s){zt.update(i=>(i.spatial.builds++,i.spatial.lastBuildMs=e,i.spatial.totalBuildMs+=e,i.spatial.avgBuildMs=i.spatial.totalBuildMs/i.spatial.builds,i.spatial.lastPageId=t,i.spatial.lastElements=n,i.spatial.lastCells=s,i))}function Zi(t,e,n){zt.update(s=>(s.spatial.adaptations++,s.spatial.lastAdaptFrom=t,s.spatial.lastAdaptTo=e,s.spatial.lastAdaptReason=n,s))}function Xi(t,e){zt.update(n=>(n.transforms.frames++,n.transforms.lastFlushMs=t,n.transforms.totalFlushMs+=t,n.transforms.avgFlushMs=n.transforms.totalFlushMs/n.transforms.frames,n.transforms.lastAppliedCount=e,n.transforms.totalApplied+=e,n))}function un(t){zt.update(e=>(e.queries.rectCount++,e.queries.lastRectCandidates=t,e.queries.totalRectCandidates+=t,e.queries.avgRectCandidates=e.queries.totalRectCandidates/e.queries.rectCount,e))}function Vi(){zt.update(t=>(t.queries.pointCount++,t))}function Ee(t){zt.update(e=>(e.queries.hitTestCount++,e.queries.lastHitTestCandidates=t,e.queries.totalHitTestCandidates+=t,e.queries.avgHitTestCandidates=e.queries.totalHitTestCandidates/e.queries.hitTestCount,e))}const Wi="studioProjectData";function Gi(){const t=Date.now(),e={id:"course-1",modules:[{id:"module-1",order:1}],cfNodeIds:[],metadata:{title:"Untitled Course",description:"",duration:0,version:1,createdAt:t,updatedAt:t,lastEditedBy:{userId:"system",name:"System"},publishedAt:"pending"}},n={id:"module-1",visible:!0,lessons:[{id:"lesson-1",order:1}],metadata:{title:"Module 1",description:"",duration:0,version:1,createdAt:t,updatedAt:t,lastEditedBy:{userId:"system",name:"System"}}},s={id:"lesson-1",type:"activity",visible:!0,pages:[{id:"page-1",order:1}],metadata:{title:"Lesson 1",duration:0,version:1,createdAt:t,updatedAt:t,lastEditedBy:{userId:"system",name:"System"}}},i={id:"page-1",visible:!0,elements:[],backgroundColor:"#ffffff",layouts:{desktop:{stageSize:{width:1280,height:720},elementProps:{}},tablet:{stageSize:{width:1024,height:768},elementProps:{}},mobile:{stageSize:{width:375,height:667},elementProps:{}}},metadata:{title:"Page 1",duration:0,version:1,createdAt:t,updatedAt:t,lastEditedBy:{userId:"system",name:"System"}}};return{projectVersion:_n,course:e,modulesById:{[n.id]:n},lessonsById:{[s.id]:s},pagesById:{[i.id]:i}}}const x=it(Gi()),ft=it("module-1"),st=it("lesson-1"),L=it("page-1"),Ki=Cn([x,L],([t,e])=>t.pagesById[e]),J=it(null),N=it(new Set),he=it(null);function Jt(){N.set(new Set),J.set(null)}function Je(t,e=!1,n=!1){if(t==null){Jt();return}const s=v(L),i=v(x).pagesById[s],a=i==null?void 0:i.elements.find(r=>r.id===t);if(a){if(a.visible===!1&&!n&&v(N).size===0&&!e){li();return}if(e&&a.locked&&v(N).size>0&&!v(N).has(t)){ai();return}}J.set(t),e?N.update(r=>{const o=new Set(r);return o.has(t)?o.delete(t):o.add(t),o.size===0&&J.set(null),o}):N.set(new Set([t]))}function Ui(t){Je(t,!1,!0)}function Qn(t){N.set(new Set(t)),J.set(t[t.length-1]??null)}function Qi(t){Je(t,!0)}function to(t){return v(N).has(t)}function eo(){return Array.from(v(N))}function no(t){var o,l,c,d,f,u;const e=v(N);if(!e.size)return null;const n=v(x).pagesById[t];if(!n)return null;let s=1/0,i=1/0,a=-1/0,r=-1/0;for(const b of e){const m=n.elements.find(w=>w.id===b);if(!m)continue;const y=((o=m.position)==null?void 0:o.x)??0,p=((l=m.position)==null?void 0:l.y)??0,g=((d=(c=m.size)==null?void 0:c.dimensions)==null?void 0:d.width)??0,h=((u=(f=m.size)==null?void 0:f.dimensions)==null?void 0:u.height)??0;y<s&&(s=y),p<i&&(i=p),y+g>a&&(a=y+g),p+h>r&&(r=p+h)}return s===1/0?null:{x:s,y:i,width:a-s,height:r-i}}const T=new Map,xt={},At=new Map;let Kt={enabled:!0,threshold:80,cellSize:128};Wn.subscribe(t=>{Kt=t});const ts={},U={};let jt={enabled:!0,margin:120};Kn.subscribe(t=>{jt=t,io()});function es(t){return ts[t]??null}function so(t,e){ts[t]=e,je(t)}function je(t){var c,d,f,u,b,m;if(!jt.enabled){delete U[t];return}const e=es(t);if(!e){delete U[t];return}const n=v(x).pagesById[t];if(!n)return;const s=jt.margin,i=e.x-s,a=e.y-s,r=e.width+s*2,o=e.height+s*2,l=U[t]??(U[t]=new Set);l.clear();for(const y of n.elements){const p=((c=y.position)==null?void 0:c.x)??0,g=((d=y.position)==null?void 0:d.y)??0,h=((u=(f=y.size)==null?void 0:f.dimensions)==null?void 0:u.width)??0,w=((m=(b=y.size)==null?void 0:b.dimensions)==null?void 0:m.height)??0;p+h<i||p>i+r||g+w<a||g>a+o||l.add(y.id)}}function io(){const t=v(L);t&&je(t)}function oo(t){return U[t]??null}function ro(t,e){const n=U[t];return n?n.has(e):!0}function ao(t,e){var u,b,m,y,p,g;if(!jt.enabled)return!0;const n=es(t);if(!n)return!0;const s=jt.margin,i=n.x-s,a=n.y-s,r=n.width+s*2,o=n.height+s*2,l=((u=e.position)==null?void 0:u.x)??0,c=((b=e.position)==null?void 0:b.y)??0,d=((y=(m=e.size)==null?void 0:m.dimensions)==null?void 0:y.width)??0,f=((g=(p=e.size)==null?void 0:p.dimensions)==null?void 0:g.height)??0;return!(l+d<i||l>i+r||c+f<a||c>a+o)}function Ye(t,e){if(!jt.enabled)return;const n=U[t];n&&(ao(t,e)?n.add(e.id):n.delete(e.id))}const Ot={},lt=new Set,Re={};function Fe(t){return Re[t]??Kt.cellSize}function ns(t,e){return t+","+e}function ss(t){return Ot[t]??(Ot[t]={cells:new Map,elementCells:new Map,cellSize:Fe(t)})}function $e(t){return Kt.enabled&&t.elements.length>=Kt.threshold}function Ze(t,e){var m,y,p,g,h,w;if(!v(x).pagesById[t]||!lt.has(t))return;const s=ss(t),i=((y=(m=e.size)==null?void 0:m.dimensions)==null?void 0:y.width)??0,a=((g=(p=e.size)==null?void 0:p.dimensions)==null?void 0:g.height)??0,r=((h=e.position)==null?void 0:h.x)??0,o=((w=e.position)==null?void 0:w.y)??0,l=s.cellSize,c=Math.floor(r/l),d=Math.floor((r+i)/l),f=Math.floor(o/l),u=Math.floor((o+a)/l),b=[];for(let M=c;M<=d;M++)for(let A=f;A<=u;A++){const S=ns(M,A);let I=s.cells.get(S);I||(I=new Set,s.cells.set(S,I)),I.add(e.id),b.push(S)}s.elementCells.set(e.id,b)}function Xe(t,e){const n=Ot[t];if(!n)return;const s=n.elementCells.get(e);if(s){for(const i of s){const a=n.cells.get(i);a&&(a.delete(e),a.size||n.cells.delete(i))}n.elementCells.delete(e)}}function is(t,e){lt.has(t)&&(Xe(t,e.id),Ze(t,e))}function lo(t){const e=v(x).pagesById[t];if(!e)return;if(!$e(e)){lt.delete(t),delete Ot[t],delete Re[t];return}lt.add(t);let n=!1;const s=()=>{const i=ss(t);i.cellSize=Fe(t),i.cells.clear(),i.elementCells.clear();const a=me();for(const m of e.elements)Ze(t,m);const r=me()-a;$i(t,r,e.elements.length,i.cells.size);const o=i.cells.size||1,l=e.elements.length/o,c=i.cellSize,d=32,f=256;let u=c,b=null;l>25&&c>d?(u=Math.max(d,Math.floor(c/2)),b="densely-populated-split"):l<4&&c<f&&c<Kt.cellSize&&(u=Math.min(f,c*2),b="sparse-coarsen"),!b&&i.cells.size>e.elements.length*4&&c<f&&(u=Math.min(f,c*2),b="oversharding-coarsen"),u!==c&&!n&&(Re[t]=u,n=!0,b&&Zi(c,u,b),s())};s()}function co(t){var e;return lt.has(t)?((e=Ot[t])==null?void 0:e.cellSize)??Fe(t):null}function os(t,e,n,s,i,a=!1){const r=v(x).pagesById[t];if(!r)return[];const o=U[t];if(!lt.has(t)){let p=r.elements;o&&(p=p.filter(h=>o.has(h.id)));const g=p.filter(h=>mn(h,e,n,s,i)).map(h=>h.id);return a||un(r.elements.length),g}const l=Ot[t];if(!l)return[];const c=l.cellSize,d=Math.floor(e/c),f=Math.floor((e+s)/c),u=Math.floor(n/c),b=Math.floor((n+i)/c),m=new Set;for(let p=d;p<=f;p++)for(let g=u;g<=b;g++){const h=l.cells.get(ns(p,g));if(h)for(const w of h)m.add(w)}const y=[];for(const p of m){if(o&&!o.has(p))continue;const g=r.elements.find(h=>h.id===p);g&&mn(g,e,n,s,i)&&y.push(p)}return a||un(m.size),y}function rs(t,e,n){const s=os(t,e,n,1,1,!0);return Vi(),s}function mn(t,e,n,s,i){var c,d,f,u,b,m;const a=((c=t.position)==null?void 0:c.x)??0,r=((d=t.position)==null?void 0:d.y)??0,o=((u=(f=t.size)==null?void 0:f.dimensions)==null?void 0:u.width)??0,l=((m=(b=t.size)==null?void 0:b.dimensions)==null?void 0:m.height)??0;return!(a+o<e||a>e+s||r+l<n||r>n+i)}function fo(t,e,n,s={}){const{all:i=!1,includeHidden:a=!1,margin:r=0}=s,o=v(x).pagesById[t];if(!o)return null;const l=lt.has(t)?rs(t,e,n):o.elements.map(u=>u.id),c=U[t],d=c?l.filter(u=>c.has(u)):l;if(!d.length)return Ee(0),null;const f=[];for(const u of d){const b=o.elements.find(m=>m.id===u);b&&(!a&&b.visible===!1||uo(b,e,n,r)&&f.push({id:u,z:b.zIndex??0}))}return f.length?(f.sort((u,b)=>u.z-b.z),Ee(d.length),i?f.map(u=>u.id):f[f.length-1].id):(Ee(d.length),null)}function uo(t,e,n,s){var l,c,d,f,u,b;const i=((l=t.position)==null?void 0:l.x)??0,a=((c=t.position)==null?void 0:c.y)??0,r=((f=(d=t.size)==null?void 0:d.dimensions)==null?void 0:f.width)??0,o=((b=(u=t.size)==null?void 0:u.dimensions)==null?void 0:b.height)??0;return e>=i-s&&e<=i+r+s&&n>=a-s&&n<=a+o+s}const St=new Map;let Te=!1;function as(){if(!St.size)return;const t=me();let e=0;const n=new Set,s=new Map;x.update(a=>{for(const[r,o]of St){const l=T.get(r);if(!l)continue;const c=a.pagesById[l];if(!c)continue;const d=c.elements.find(f=>f.id===r);if(d){if(o.x!==void 0||o.y!==void 0)if(d.parentId){const f=c.elements.find(u=>u.id===d.parentId);f?((o.x!==void 0||o.y!==void 0)&&(d.position={x:o.x!==void 0?o.x:d.position.x,y:o.y!==void 0?o.y:d.position.y}),n.add(f.id)):d.position={x:o.x??d.position.x,y:o.y??d.position.y}}else d.position={x:o.x??d.position.x,y:o.y??d.position.y};if(o.width!==void 0||o.height!==void 0){const f=d.size.locked??!1;d.size={dimensions:{width:o.width??d.size.dimensions.width,height:o.height??d.size.dimensions.height},locked:f},d.parentId&&n.add(d.parentId)}if(o.rotation!==void 0){const f=(o.rotation%360+360)%360;d.rotation=f}if(lt.has(l)&&is(l,d),U[l]){let f=s.get(l);f||(f=[],s.set(l,f)),f.push(d)}e++,tt(l),Lt.has(l)?ae.add(l):j(l,"transform")}}St.clear();for(const r of n){const o=T.get(r);if(!o)continue;const l=a.pagesById[o];if(!l)continue;const c=l.elements.find(g=>g.id===r);if(!c||c.type!=="collection")continue;const d=c.memberIds.map(g=>l.elements.find(h=>h.id===g)).filter(Boolean);if(d.length<2){const g=l.elements.findIndex(h=>h.id===r);if(g!==-1){for(const h of d)h.position.x=c.position.x+h.position.x,h.position.y=c.position.y+h.position.y,delete h.parentId;l.elements.splice(g,1)}continue}let f=1/0,u=1/0,b=-1/0,m=-1/0;for(const g of d){const h=c.position.x+g.position.x,w=c.position.y+g.position.y,M=g.size.dimensions.width,A=g.size.dimensions.height;h<f&&(f=h),w<u&&(u=w),h+M>b&&(b=h+M),w+A>m&&(m=w+A)}if(f===1/0)continue;const y=f-c.position.x,p=u-c.position.y;if(y||p){for(const g of d)g.position.x-=y,g.position.y-=p;c.position.x=f,c.position.y=u}c.size.dimensions.width=b-f,c.size.dimensions.height=m-u}return a});const i=me()-t;Xi(i,e);for(const[a,r]of s){const o=U[a];if(!o)continue;const l=Math.max(50,o.size*.4);if(r.length>l)je(a);else for(const c of r)Ye(a,c)}}function Ve(){Te||(Te=!0,requestAnimationFrame(()=>{Te=!1,as()}))}function We(){as()}function Ge(t){T.clear();for(const[e,n]of Object.entries(t.pagesById)){const s=n;e in xt||(xt[e]=0);for(const i of s.elements)T.set(i.id,e),At.set(i.id,Qt(i))}}function tt(t){xt[t]=(xt[t]??0)+1}function ls(t){return xt[t]??0}function Qt(t){var n;const e={id:t.id,t:t.type,p:t.position,s:(n=t.size)==null?void 0:n.dimensions,r:t.rotation,o:t.opacity,v:t.visible,l:t.locked,z:t.zIndex,st:t.style?Object.keys(t.style).length:0};return JSON.stringify(e)}function mo(){x.update(t=>{t.course.modules.length||(t.course.modules.push({id:"module-1",order:1}),t.modulesById["module-1"]={id:"module-1",visible:!0,lessons:[{id:"lesson-1",order:1}],metadata:{title:"Module 1",description:"",duration:0,version:1,createdAt:Date.now(),updatedAt:Date.now(),lastEditedBy:{userId:"system",name:"System"}}});const e=t.modulesById[t.course.modules[0].id];e.lessons.length||(e.lessons.push({id:"lesson-1",order:1}),t.lessonsById["lesson-1"]={id:"lesson-1",type:"activity",visible:!0,pages:[{id:"page-1",order:1}],metadata:{title:"Lesson 1",duration:0,version:1,createdAt:Date.now(),updatedAt:Date.now(),lastEditedBy:{userId:"system",name:"System"}}});const n=t.lessonsById[e.lessons[0].id];return n.pages.length||(n.pages.push({id:"page-1",order:1}),t.pagesById["page-1"]={id:"page-1",visible:!0,elements:[],backgroundColor:"#ffffff",layouts:{desktop:{stageSize:{width:1280,height:720},elementProps:{}},tablet:{stageSize:{width:1024,height:768},elementProps:{}},mobile:{stageSize:{width:375,height:667},elementProps:{}}},metadata:{title:"Page 1",duration:0,version:1,createdAt:Date.now(),updatedAt:Date.now(),lastEditedBy:{userId:"system",name:"System"}}}),Ge(t),t})}function ho(t,e,n){const s=(n%360+360)%360;x.update(i=>{const a=i.pagesById[t];if(!a)return i;const r=a.elements.find(o=>o.id===e);return!r||r.locked||r.rotation===s||(r.rotation=s,tt(t),j(t,"transform")),i})}function po(t){if(t===null||typeof t!="object")return t;if(typeof structuredClone=="function")try{return structuredClone(t)}catch{}try{return JSON.parse(JSON.stringify(t))}catch{return t}}function cs(t,e){if(!(!e||typeof e!="object"))for(const[n,s]of Object.entries(e))s&&typeof s=="object"&&!Array.isArray(s)?((!t[n]||typeof t[n]!="object"||Array.isArray(t[n]))&&(t[n]={}),cs(t[n],s)):Array.isArray(s)?t[n]=po(s):t[n]=s}function go(t,e,n){if(!e||typeof e!="object")return;const s=(n==null?void 0:n.pageId)??T.get(t)??v(L);if(!s)return;const i=(n==null?void 0:n.reason)??"style";j(s,i),x.update(a=>{const r=a.pagesById[s];if(!r)return a;const o=r.elements.find(l=>l.id===t);return!o||o.locked||(cs(o,e),tt(s),At.set(t,Qt(o)),lt.has(s)&&is(s,o),U[s]&&Ye(s,o)),a})}function yo(){De();let t="";return x.update(e=>{var a;const n=$n();t=n;const s=(((a=e.course.modules[e.course.modules.length-1])==null?void 0:a.order)??0)+1,i={id:n,visible:!0,lessons:[],metadata:{title:"",description:"",duration:0,version:1,createdAt:Date.now(),updatedAt:Date.now(),lastEditedBy:{userId:"system",name:"System"}}};return e.course.modules.push({id:n,order:s}),e.modulesById[n]=i,ft.set(n),e}),t}function bo(t){Ht(t);let e=null;return x.update(n=>{var o;const s=n.modulesById[t];if(!s)return n;const i=Zn();e=i;const a=(((o=s.lessons[s.lessons.length-1])==null?void 0:o.order)??0)+1,r={id:i,type:"activity",visible:!0,pages:[],metadata:{title:"",duration:0,version:1,createdAt:Date.now(),updatedAt:Date.now(),lastEditedBy:{userId:"system",name:"System"}}};return s.lessons.push({id:i,order:a}),n.lessonsById[i]=r,ft.set(t),st.set(i),n}),e}function vo(t){Dt(t);let e=null;return x.update(n=>{var o;const s=n.lessonsById[t];if(!s)return n;const i=Xn();e=i;const a=(((o=s.pages[s.pages.length-1])==null?void 0:o.order)??0)+1,r={id:i,visible:!0,elements:[],backgroundColor:"#ffffff",layouts:{desktop:{stageSize:{width:1280,height:720},elementProps:{}},tablet:{stageSize:{width:1024,height:768},elementProps:{}},mobile:{stageSize:{width:375,height:667},elementProps:{}}},metadata:{title:"",duration:0,version:1,createdAt:Date.now(),updatedAt:Date.now(),lastEditedBy:{userId:"system",name:"System"}}};return s.pages.push({id:i,order:a}),n.pagesById[i]=r,st.set(t),L.set(i),xt[i]=0,n}),e}function wo(t,e){Ht(t),x.update(n=>{const s=n.modulesById[t];return s&&(s.metadata.title=e||s.metadata.title,s.metadata.updatedAt=Date.now()),n})}function So(t,e){v(x).lessonsById[t]&&(Dt(t),x.update(s=>{const i=s.lessonsById[t];return i&&(i.metadata.title=e||i.metadata.title,i.metadata.updatedAt=Date.now()),s}))}function xo(t,e){j(t,"structure"),x.update(n=>{const s=n.pagesById[t];return s&&(s.metadata.title=e||s.metadata.title,s.metadata.updatedAt=Date.now()),n})}function Io(t,e,n){t!==e&&(De(),x.update(s=>{const i=s.course.modules,a=i.findIndex(c=>c.id===t),r=i.findIndex(c=>c.id===e);if(a===-1||r===-1)return s;const[o]=i.splice(a,1);let l=r+(n?0:1);return a<r&&l--,l<0&&(l=0),l>i.length&&(l=i.length),i.splice(l,0,o),i.forEach((c,d)=>c.order=d+1),s}))}function zo(t,e,n,s){e!==n&&(Ht(t),x.update(i=>{const a=i.modulesById[t];if(!a)return i;const r=a.lessons,o=r.findIndex(f=>f.id===e),l=r.findIndex(f=>f.id===n);if(o===-1||l===-1)return i;const[c]=r.splice(o,1);let d=l+(s?0:1);return o<l&&d--,d<0&&(d=0),d>r.length&&(d=r.length),r.splice(d,0,c),r.forEach((f,u)=>f.order=u+1),i}))}function Bo(t,e,n,s){e!==n&&(Dt(t),x.update(i=>{const a=i.lessonsById[t];if(!a)return i;const r=a.pages,o=r.findIndex(f=>f.id===e),l=r.findIndex(f=>f.id===n);if(o===-1||l===-1)return i;const[c]=r.splice(o,1);let d=l+(s?0:1);return o<l&&d--,d<0&&(d=0),d>r.length&&(d=r.length),r.splice(d,0,c),r.forEach((f,u)=>f.order=u+1),i}))}function ko(t,e,n,s){x.update(i=>{let a=null;for(const d of i.course.modules){const f=i.modulesById[d.id];if(f.lessons.some(u=>u.id===t)){a=f.id;break}}if(!a)return i;const r=i.modulesById[a],o=i.modulesById[e];if(!r||!o||a===e&&n)return i;Ht(a),a!==e&&Ht(e);const l=r.lessons.findIndex(d=>d.id===t);if(l===-1)return i;const[c]=r.lessons.splice(l,1);if(r.lessons.forEach((d,f)=>d.order=f+1),n){const d=o.lessons.findIndex(u=>u.id===n);let f=d===-1?o.lessons.length:d+(s?0:1);f<0&&(f=0),f>o.lessons.length&&(f=o.lessons.length),o.lessons.splice(f,0,c)}else o.lessons.push(c);return o.lessons.forEach((d,f)=>d.order=f+1),v(st)===t&&ft.set(e),i})}function Co(t,e,n,s){x.update(i=>{let a=null;for(const[d,f]of Object.entries(i.lessonsById))if(f.pages.some(u=>u.id===t)){a=d;break}if(!a)return i;const r=i.lessonsById[a],o=i.lessonsById[e];if(!r||!o||a===e&&n)return i;Dt(a),a!==e&&Dt(e);const l=r.pages.findIndex(d=>d.id===t);if(l===-1)return i;const[c]=r.pages.splice(l,1);if(r.pages.forEach((d,f)=>d.order=f+1),n){const d=o.pages.findIndex(u=>u.id===n);let f=d===-1?o.pages.length:d+(s?0:1);f<0&&(f=0),f>o.pages.length&&(f=o.pages.length),o.pages.splice(f,0,c)}else o.pages.push(c);return o.pages.forEach((d,f)=>d.order=f+1),v(L)===t&&st.set(e),i})}function Mo(t){const e=v(st);e&&Dt(e),x.update(n=>{var a;let s=null;for(const[r,o]of Object.entries(n.lessonsById)){const l=o,c=l.pages.findIndex(d=>d.id===t);if(c!==-1){s=r,l.pages.splice(c,1);break}}const i=n.pagesById[t];if(i){for(const r of i.elements)T.delete(r.id);delete n.pagesById[t],delete xt[t]}if(v(L)===t&&s){const o=(a=n.lessonsById[s].pages[0])==null?void 0:a.id;o&&L.set(o)}return n})}function Ao(t){const e=v(ft);e&&Ht(e),x.update(n=>{var a,r,o;let s=null;for(const[l,c]of Object.entries(n.modulesById)){const d=c,f=d.lessons.findIndex(u=>u.id===t);if(f!==-1){s=l,d.lessons.splice(f,1);break}}const i=n.lessonsById[t];if(i){for(const l of i.pages){const c=n.pagesById[l.id];if(c){for(const d of c.elements)T.delete(d.id);delete n.pagesById[l.id],delete xt[l.id]}}delete n.lessonsById[t]}if(v(st)===t&&s){const c=(a=n.modulesById[s].lessons[0])==null?void 0:a.id;c&&st.set(c);const d=c?(o=(r=n.lessonsById[c])==null?void 0:r.pages[0])==null?void 0:o.id:void 0;d&&L.set(d)}return n})}function Eo(t){De(),x.update(e=>{var i,a,r,o,l;const n=e.course.modules.findIndex(c=>c.id===t);n!==-1&&e.course.modules.splice(n,1);const s=e.modulesById[t];if(s){for(const c of s.lessons){const d=e.lessonsById[c.id];if(d){for(const f of d.pages){const u=e.pagesById[f.id];if(u){for(const b of u.elements)T.delete(b.id);delete e.pagesById[f.id],delete xt[f.id]}}delete e.lessonsById[c.id]}}delete e.modulesById[t]}if(v(ft)===t){const c=(i=e.course.modules[0])==null?void 0:i.id;c&&ft.set(c);const d=c?(r=(a=e.modulesById[c])==null?void 0:a.lessons[0])==null?void 0:r.id:void 0;d&&st.set(d);const f=d?(l=(o=e.lessonsById[d])==null?void 0:o.pages[0])==null?void 0:l.id:void 0;f&&L.set(f)}return e})}function To(t){x.update(e=>{let n=null,s=null;for(const[i,a]of Object.entries(e.lessonsById))if(a.pages.some(o=>o.id===t)){n=i;break}if(n){for(const[i,a]of Object.entries(e.modulesById))if(a.lessons.some(o=>o.id===n)){s=i;break}}return s&&ft.set(s),n&&st.set(n),L.set(t),e})}function ds(t,e){j(t,"structure"),x.update(n=>{const s=n.pagesById[t];return s&&(s.elements.push(e),T.set(e.id,t),At.set(e.id,Qt(e)),tt(t),$e(s)&&!lt.has(t)?lo(t):lt.has(t)&&Ze(t,e),U[t]&&Ye(t,e)),n})}let Oe=0;function Oo(){const i=40+Oe%14*32,a=40+Math.floor(Oe/14)*32;return Oe++,{x:i,y:a}}function _o(t){const e=Oo(),n={name:t.charAt(0).toUpperCase()+t.slice(1),type:t,position:e,size:{dimensions:{width:120,height:80},locked:!1},shadow:{color:"rgba(0,0,0,0.15)",offsetX:0,offsetY:2,blur:6},rotation:0,opacity:1,visible:!0,zIndex:1};switch(t){case"rectangle":n.size.dimensions={width:160,height:100},n.style={strokeColor:"#1f2937",fillColor:"#3b82f6",strokeWidth:1,strokeStyle:"solid",padding:{top:0,right:0,bottom:0,left:0},borderRadius:{dimensions:{topLeft:4,topRight:4,bottomRight:4,bottomLeft:4},locked:!0}};break;case"ellipse":n.size.dimensions={width:100,height:100},n.style={strokeColor:"#1f2937",fillColor:"#f59e0b",strokeWidth:1,strokeStyle:"solid",padding:{top:0,right:0,bottom:0,left:0},borderRadius:{dimensions:{topLeft:50,topRight:50,bottomRight:50,bottomLeft:50},locked:!0}};break;case"line":n.size.dimensions={width:180,height:4},n.style={strokeColor:"#1f2937",strokeWidth:2,strokeStyle:"solid"};break;case"text":n.size.dimensions={width:220,height:60},n.style={fontSize:18,fontFamily:"Inter, system-ui, sans-serif",color:"#111827",textAlign:"left",fontWeight:"normal",placement:"top",highlight:{color:"#ffff00",start:0,end:0},content:"New Text"};break;case"image":n.size.dimensions={width:200,height:140},n.style={src:"",alt:"Image",fit:"cover",borderRadius:4,opacity:1,filters:{brightness:100,contrast:100,grayscale:0,blur:0}};break;case"hotspot":n.size.dimensions={width:120,height:80},n.style={strokeColor:"#dc2626",fillColor:"rgba(220,38,38,0.15)",strokeWidth:1,strokeStyle:"dashed",padding:{top:0,right:0,bottom:0,left:0},borderRadius:{dimensions:{topLeft:4,topRight:4,bottomRight:4,bottomLeft:4},locked:!0}};break;case"collection":n.size.dimensions={width:240,height:160},n.style={strokeColor:"#0f172a",fillColor:"#e2e8f0",strokeWidth:2,strokeStyle:"solid",padding:{top:4,right:4,bottom:4,left:4},borderRadius:{dimensions:{topLeft:6,topRight:6,bottomRight:6,bottomLeft:6},locked:!0}},n.elements=[];break}return n}function Po(t,e,n={}){const s=_o(t),i={id:He(),...s,...n};return ds(e,i),i.id}function No(t){const e=T.get(t);if(!e)return;j(e,"structure");let n=null;if(x.update(s=>{const i=s.pagesById[e];if(!i)return s;const a=i.elements.find(o=>o.id===t);a!=null&&a.parentId&&(n=a.parentId);const r=i.elements.findIndex(o=>o.id===t);if(r!==-1&&i.elements.splice(r,1),T.delete(t),At.delete(t),n){const o=i.elements.find(l=>l.id===n);o&&o.type==="collection"&&(o.memberIds=o.memberIds.filter(l=>l!==t))}if(tt(e),lt.has(e)){Xe(e,t);const o=s.pagesById[e];o&&!$e(o)&&(lt.delete(e),delete Ot[e])}return U[e]&&U[e].delete(t),N.update(o=>{if(!o.has(t))return o;const l=new Set(o);return l.delete(t),l.size?l.has(v(J)||"")||J.set(Array.from(l)[l.size-1]):J.set(null),l}),s}),n){const s=v(x).pagesById[e],i=s==null?void 0:s.elements.find(a=>a.id===n);i&&i.type==="collection"&&(i.memberIds.length<2?te(i.id):Ke(i.id))}}function Ro(t){if(!t.length)return;const e=T.get(t[0]);if(!e)return;const n=t.filter(a=>T.get(a)===e);if(!n.length)return;const s=new Set;x.update(a=>{const r=a.pagesById[e];if(!r)return a;let o=!1;for(const l of n){const c=r.elements.find(f=>f.id===l);c!=null&&c.parentId&&s.add(c.parentId);const d=r.elements.findIndex(f=>f.id===l);d!==-1&&(r.elements.splice(d,1),o=!0),T.delete(l),At.delete(l),lt.has(e)&&Xe(e,l),U[e]&&U[e].delete(l)}for(const l of s){const c=r.elements.find(d=>d.id===l);c&&c.type==="collection"&&(c.memberIds=c.memberIds.filter(d=>!n.includes(d)))}return o&&tt(e),a}),Jt(),j(e,"structure");const i=v(x).pagesById[e];if(i)for(const a of s){const r=i.elements.find(o=>o.id===a);r&&r.type==="collection"&&(r.memberIds.length<2?te(r.id):Ke(r.id))}}function fs(t,e,n){if(!T.get(t))return;const i=St.get(t)??{};i.x=e,i.y=n,St.set(t,i),Ve()}function qo(t,e,n){if(!T.get(t))return;const i=St.get(t)??{};i.width=e,i.height=n,St.set(t,i),Ve()}function Lo(t,e){if(!T.get(t))return;const s=St.get(t)??{};s.rotation=e,St.set(t,s),Ve()}function Do(){if(!J)return;const t=v(L);x.update(e=>{const n=e.pagesById[t];return n.elements=n.elements.map(s=>s.id===v(J)?{...s,locked:!s.locked}:s),{...e}})}function Ho(){if(!J)return;const t=v(L);x.update(e=>{const n=e.pagesById[t];return n.elements=n.elements.map(s=>s.id===v(J)?{...s,visible:!s.visible}:s),{...e}})}function Jo(t){const e=T.get(t);e&&qn(e)}function jo(t){const e=T.get(t);e&&(We(),Ln(e))}function Yo(){const t=Array.from(v(N));if(!t.length)return;const e=T.get(t[0]);e&&qn(e)}function Fo(t,e){var s,i;const n=Array.from(v(N));for(const a of n){const r=T.get(a);if(!r)continue;const o=v(x).pagesById[r];if(!o)continue;const l=o.elements.find(c=>c.id===a);l&&fs(a,(((s=l.position)==null?void 0:s.x)??0)+t,(((i=l.position)==null?void 0:i.y)??0)+e)}}function $o(){const t=Array.from(v(N));if(!t.length)return;const e=T.get(t[0]);e&&(We(),Ln(e))}function Zo(t,e,n,s,i,a=!1){var u,b,m,y,p,g;const r=Math.min(e,s),o=Math.min(n,i),l=Math.max(e,s),c=Math.max(n,i),d=v(x).pagesById[t];if(!d)return[];const f=[];for(const h of d.elements){if(h.visible===!1||h.locked)continue;const w=((u=h.position)==null?void 0:u.x)??0,M=((b=h.position)==null?void 0:b.y)??0,A=((y=(m=h.size)==null?void 0:m.dimensions)==null?void 0:y.width)??0,S=((g=(p=h.size)==null?void 0:p.dimensions)==null?void 0:g.height)??0;w>=r&&M>=o&&w+A<=l&&M+S<=c&&f.push(h.id)}return a?N.update(h=>{const w=new Set(h);for(const M of f)w.has(M)?w.delete(M):w.add(M);return J.set(f[f.length-1]??v(J)),w.size||J.set(null),w}):Qn(f),f}function us(t,e){const n=Array.from(v(N));n.length&&x.update(s=>{const i=s.pagesById[t];if(!i)return s;const a=i.elements.filter(r=>n.includes(r.id));return a.length<2||(e(a),tt(t),j(t,"transform")),s})}function ms(t,e){us(t,n=>{var c,d,f,u,b,m,y,p,g,h;let s=1/0,i=-1/0,a=1/0,r=-1/0;for(const w of n){const M=((c=w.position)==null?void 0:c.x)??0,A=((d=w.position)==null?void 0:d.y)??0,S=((u=(f=w.size)==null?void 0:f.dimensions)==null?void 0:u.width)??0,I=((m=(b=w.size)==null?void 0:b.dimensions)==null?void 0:m.height)??0;M<s&&(s=M),A<a&&(a=A),M+S>i&&(i=M+S),A+I>r&&(r=A+I)}const o=(s+i)/2,l=(a+r)/2;for(const w of n){const M=((p=(y=w.size)==null?void 0:y.dimensions)==null?void 0:p.width)??0,A=((h=(g=w.size)==null?void 0:g.dimensions)==null?void 0:h.height)??0;switch(e){case"left":w.position.x=s;break;case"right":w.position.x=i-M;break;case"top":w.position.y=a;break;case"bottom":w.position.y=r-A;break;case"hcenter":w.position.x=Math.round(o-M/2);break;case"vcenter":w.position.y=Math.round(l-A/2);break}}})}function hs(t,e){us(t,n=>{if(n.length<3)return;n.sort((a,r)=>e==="horizontal"?a.position.x-r.position.x:a.position.y-r.position.y);const s=n[0],i=n[n.length-1];if(e==="horizontal"){const a=i.position.x+i.size.dimensions.width-s.position.x,r=n.reduce((c,d)=>c+d.size.dimensions.width,0),o=(a-r)/(n.length-1);let l=s.position.x+s.size.dimensions.width+o;for(let c=1;c<n.length-1;c++){const d=n[c];d.position.x=Math.round(l),l+=d.size.dimensions.width+o}}else{const a=i.position.y+i.size.dimensions.height-s.position.y,r=n.reduce((c,d)=>c+d.size.dimensions.height,0),o=(a-r)/(n.length-1);let l=s.position.y+s.size.dimensions.height+o;for(let c=1;c<n.length-1;c++){const d=n[c];d.position.y=Math.round(l),l+=d.size.dimensions.height+o}}})}function ps(t,e){const n=Array.from(v(N));if(n.length!==1)return;const s=n[0];x.update(i=>{var d,f,u,b,m,y;const a=i.pagesById[t];if(!a)return i;const r=a.elements.find(p=>p.id===s);if(!r||r.locked)return i;const o=((f=(d=a.layouts)==null?void 0:d.desktop)==null?void 0:f.stageSize)||{width:1280,height:720},l=((b=(u=r.size)==null?void 0:u.dimensions)==null?void 0:b.width)??0,c=((y=(m=r.size)==null?void 0:m.dimensions)==null?void 0:y.height)??0;switch(e){case"left":r.position.x=0;break;case"right":r.position.x=Math.max(0,o.width-l);break;case"top":r.position.y=0;break;case"bottom":r.position.y=Math.max(0,o.height-c);break;case"hcenter":r.position.x=Math.round((o.width-l)/2);break;case"vcenter":r.position.y=Math.round((o.height-c)/2);break}return tt(t),j(t,"transform"),i})}function Xo(t,e){}function gs(t,e){const n=T.get(t);n&&x.update(s=>{var h,w,M,A,S,I,_,ut,Q,ot;const i=s.pagesById[n];if(!i)return s;const a=i.elements.find(B=>B.id===t&&B.type==="collection");if(!a)return s;const r=a.memberIds||[];if(r.length<2)return s;const o=i.elements.filter(B=>r.includes(B.id));let l=1/0,c=-1/0,d=1/0,f=-1/0;for(const B of o){const D=((h=B.position)==null?void 0:h.x)??0,O=((w=B.position)==null?void 0:w.y)??0,et=((A=(M=B.size)==null?void 0:M.dimensions)==null?void 0:A.width)??0,V=((I=(S=B.size)==null?void 0:S.dimensions)==null?void 0:I.height)??0;D<l&&(l=D),O<d&&(d=O),D+et>c&&(c=D+et),O+V>f&&(f=O+V)}const u=(l+c)/2,b=(d+f)/2;for(const B of o){const D=((ut=(_=B.size)==null?void 0:_.dimensions)==null?void 0:ut.width)??0,O=((ot=(Q=B.size)==null?void 0:Q.dimensions)==null?void 0:ot.height)??0;switch(e){case"left":B.position.x=l;break;case"right":B.position.x=c-D;break;case"top":B.position.y=d;break;case"bottom":B.position.y=f-O;break;case"hcenter":B.position.x=Math.round(u-D/2);break;case"vcenter":B.position.y=Math.round(b-O/2);break}}let m=1/0,y=1/0,p=-1/0,g=-1/0;for(const B of o){const D=B.position.x,O=B.position.y,et=B.size.dimensions.width,V=B.size.dimensions.height;D<m&&(m=D),O<y&&(y=O),D+et>p&&(p=D+et),O+V>g&&(g=O+V)}if(m!==1/0){a.size.dimensions.width=p-m,a.size.dimensions.height=g-y,a.position.x+=m,a.position.y+=y;for(const B of o)B.position.x-=m,B.position.y-=y}return tt(n),j(n,"transform"),s})}function ys(t,e){const n=T.get(t);n&&x.update(s=>{const i=s.pagesById[n];if(!i)return s;const a=i.elements.find(m=>m.id===t&&m.type==="collection");if(!a)return s;const r=a.memberIds||[];if(r.length<3)return s;const o=i.elements.filter(m=>r.includes(m.id));if(o.length<3)return s;e==="horizontal"?o.sort((m,y)=>m.position.x-y.position.x):o.sort((m,y)=>m.position.y-y.position.y);const l=o[0],c=o[o.length-1];if(e==="horizontal"){const m=c.position.x+c.size.dimensions.width-l.position.x,y=o.reduce((h,w)=>h+w.size.dimensions.width,0),p=(m-y)/(o.length-1);let g=l.position.x+l.size.dimensions.width+p;for(let h=1;h<o.length-1;h++){const w=o[h];w.position.x=Math.round(g),g+=w.size.dimensions.width+p}}else{const m=c.position.y+c.size.dimensions.height-l.position.y,y=o.reduce((h,w)=>h+w.size.dimensions.height,0),p=(m-y)/(o.length-1);let g=l.position.y+l.size.dimensions.height+p;for(let h=1;h<o.length-1;h++){const w=o[h];w.position.y=Math.round(g),g+=w.size.dimensions.height+p}}let d=1/0,f=1/0,u=-1/0,b=-1/0;for(const m of o){const y=m.position.x,p=m.position.y,g=m.size.dimensions.width,h=m.size.dimensions.height;y<d&&(d=y),p<f&&(f=p),y+g>u&&(u=y+g),p+h>b&&(b=p+h)}if(d!==1/0){a.size.dimensions.width=u-d,a.size.dimensions.height=b-f,a.position.x+=d,a.position.y+=f;for(const m of o)m.position.x-=d,m.position.y-=f}return tt(n),j(n,"transform"),s})}function Vo(t){const e=Array.from(v(N));if(!e.length)return{};const n={};return x.update(s=>{var r;const i=s.pagesById[t];if(!i)return s;const a=[];for(const o of e){const l=i.elements.find(f=>f.id===o);if(!l)continue;const c=JSON.parse(JSON.stringify(l)),d=He();c.id=d,a.push(c),n[o]=d}for(const o of a)i.elements.push(o),T.set(o.id,t),At.set(o.id,Qt(o));return tt(t),N.set(new Set(Object.values(n))),J.set(((r=a[a.length-1])==null?void 0:r.id)??null),s}),n}function bs(){var d,f,u,b,m,y;const t=Array.from(v(N));if(t.length<2)return;const e=t.map(p=>T.get(p)).find(Boolean);if(!e)return;const n=v(x).pagesById[e];if(!n)return;let s=null;for(const p of t){const g=n.elements.find(w=>w.id===p);if(!g)return;const h=g.parentId||null;if(s===null)s=h;else if(s!==h)return}if(t.some(p=>{const g=n.elements.find(h=>h.id===p);return(g==null?void 0:g.type)==="collection"}))return;if(s){const p=n.elements.find(g=>g.id===s);if((p==null?void 0:p.type)==="collection"){const g=p.memberIds||[];if(g.length&&g.length===t.length&&t.every(w=>g.includes(w)))return}}let i=1/0,a=1/0,r=-1/0,o=-1/0;for(const p of t){const g=n.elements.find(S=>S.id===p);if(!g)continue;const h=((d=g.position)==null?void 0:d.x)??0,w=((f=g.position)==null?void 0:f.y)??0,M=((b=(u=g.size)==null?void 0:u.dimensions)==null?void 0:b.width)??0,A=((y=(m=g.size)==null?void 0:m.dimensions)==null?void 0:y.height)??0;h<i&&(i=h),w<a&&(a=w),h+M>r&&(r=h+M),w+A>o&&(o=w+A)}if(i===1/0)return;const l=He(),c={id:l,name:"Group",type:"collection",memberIds:t,position:{x:i,y:a},size:{dimensions:{width:Math.max(1,r-i),height:Math.max(1,o-a)},locked:!1},rotation:0,opacity:1,visible:!0,zIndex:0,style:{strokeColor:"#334155",fillColor:"rgba(226,232,240,0.35)",strokeWidth:1,strokeStyle:"dashed",padding:{top:4,right:4,bottom:4,left:4},borderRadius:{dimensions:{topLeft:4,topRight:4,bottomRight:4,bottomLeft:4},locked:!0}}};x.update(p=>{const g=p.pagesById[e];if(!g)return p;if(s){const h=g.elements.find(w=>w.id===s);(h==null?void 0:h.type)==="collection"&&(h.memberIds=h.memberIds.filter(w=>!t.includes(w)),h.memberIds.push(l),c.parentId=h.id)}for(const h of t){const w=g.elements.find(M=>M.id===h);w&&(w.position.x=(w.position.x??0)-i,w.position.y=(w.position.y??0)-a,w.parentId=l)}return g.elements.push(c),T.set(l,e),At.set(l,Qt(c)),tt(e),j(e,"structure"),N.set(new Set([l])),J.set(l),p})}function te(t){const e=T.get(t);e&&x.update(n=>{const s=n.pagesById[e];if(!s)return n;const i=s.elements.findIndex(o=>o.id===t);if(i===-1)return n;const a=s.elements[i];if((a==null?void 0:a.type)!=="collection")return n;const r=a.memberIds||[];s.elements.splice(i,1);for(const o of r){const l=s.elements.find(c=>c.id===o);l&&(l.position.x=a.position.x+l.position.x,l.position.y=a.position.y+l.position.y,delete l.parentId)}return T.delete(t),At.delete(t),tt(e),j(e,"structure"),r.length?(N.set(new Set(r)),J.set(r[r.length-1])):Jt(),n})}function Wo(t,e){const n=T.get(t);n&&(he.set(t),Ci(n),x.update(s=>{const i=s.pagesById[n];if(!i)return s;const a=i.elements.find(r=>r.id===t);if((a==null?void 0:a.type)==="collection")if(e){const r=new Set,o=[...a.memberIds||[]];for(;o.length;){const l=o.pop();r.add(l);const c=i.elements.find(d=>d.id===l);if((c==null?void 0:c.type)==="collection"&&Array.isArray(c.memberIds))for(const d of c.memberIds)r.has(d)||o.push(d)}r.has(e)?(N.set(new Set([e])),J.set(e)):Jt()}else Jt();return s}))}function Go(){const t=v(he);if(!t)return;const e=T.get(t);e&&Mi(e),he.set(null),t&&(N.set(new Set([t])),J.set(t))}function Ko(t,e,n){if(!e&&!n)return;const s=T.get(t);s&&x.update(i=>{const a=i.pagesById[s];if(!a)return i;const r=a.elements.find(o=>o.id===t);return r&&(r.position.x+=e,r.position.y+=n,tt(s),j(s,"transform")),i})}function Ke(t){const e=T.get(t);e&&x.update(n=>{const s=n.pagesById[e];if(!s)return n;const i=s.elements.find(u=>u.id===t);if(!i||i.type!=="collection")return n;const a=i.memberIds.map(u=>s.elements.find(b=>b.id===u)).filter(Boolean);if(a.length<2)return te(t),n;let r=1/0,o=1/0,l=-1/0,c=-1/0;for(const u of a){const b=i.position.x+u.position.x,m=i.position.y+u.position.y,y=u.size.dimensions.width,p=u.size.dimensions.height;b<r&&(r=b),m<o&&(o=m),b+y>l&&(l=b+y),m+p>c&&(c=m+p)}if(r===1/0)return n;const d=r-i.position.x,f=o-i.position.y;if(d||f){for(const u of a)u.position.x-=d,u.position.y-=f;i.position.x=r,i.position.y=o}return i.size.dimensions.width=l-r,i.size.dimensions.height=c-o,tt(e),j(e,"transform"),n})}function Uo(t,e,n,s,i,a=!0){const r=T.get(t);r&&x.update(o=>{const l=o.pagesById[r];if(!l)return o;const c=l.elements.find(y=>y.id===t);if(!c)return o;const d=c.size.dimensions.width||1,f=c.size.dimensions.height||1;s!==void 0&&(c.position.x=Math.round(s)),i!==void 0&&(c.position.y=Math.round(i));const u=e/d,b=n/f,m=c.memberIds.map(y=>l.elements.find(p=>p.id===y)).filter(Boolean);for(const y of m)y.position.x=Math.round(y.position.x*u),y.position.y=Math.round(y.position.y*b),y.size.dimensions.width=Math.max(1,Math.round(y.size.dimensions.width*u)),y.size.dimensions.height=Math.max(1,Math.round(y.size.dimensions.height*b));return c.size.dimensions.width=Math.round(e),c.size.dimensions.height=Math.round(n),tt(r),a&&j(r,"transform"),o})}if(typeof window<"u")try{const t=localStorage.getItem(Wi);if(t){const e=JSON.parse(t),n=Pn(e);if(n.ok&&n.data){const s=n.data;vs(s),x.set(s),Ge(s),Fn(s)}}}catch(t){console.warn("Initial load failed",t)}if(typeof window<"u"){const t=v(x);vs(t),x.set(t),Ge(t),Fn(t)}function vs(t){const e={},n={},s={},i=(a,r)=>a.startsWith(r);for(const a of t.course.modules){const r=a.id;if(!i(r,"m_")){const o=$n();a.id=o;const l=t.modulesById[r];l&&(l.id=o,t.modulesById[o]=l,delete t.modulesById[r]),e[r]=o}}for(const a of Object.values(t.modulesById))for(const r of a.lessons){const o=r.id;if(!i(o,"l_")){const l=Zn();r.id=l;const c=t.lessonsById[o];c&&(c.id=l,t.lessonsById[l]=c,delete t.lessonsById[o]),n[o]=l}}for(const a of Object.values(t.lessonsById))for(const r of a.pages){const o=r.id;if(!i(o,"p_")){const l=Xn();r.id=l;const c=t.pagesById[o];c&&(c.id=l,t.pagesById[l]=c,delete t.pagesById[o]),s[o]=l}}e[v(ft)]&&ft.set(e[v(ft)]),n[v(st)]&&st.set(n[v(st)]),s[v(L)]&&L.set(s[v(L)])}const xr=Object.freeze(Object.defineProperty({__proto__:null,activeCollectionId:he,alignCollectionMembers:gs,alignSelected:ms,alignSingleToStage:ps,beginElementInteraction:Jo,beginGroupInteraction:Yo,clearSelection:Jt,createElementOfType:Po,createElementOnPage:ds,createLesson:bo,createModule:yo,createPage:vo,currentLessonId:st,currentModuleId:ft,currentPage:Ki,currentPageId:L,deleteElementById:No,deleteElements:Ro,deleteLesson:Ao,deleteModule:Eo,deletePage:Mo,distributeCollectionMembers:ys,distributeSelected:hs,duplicateSelectionForDrag:Vo,endGroupInteraction:$o,ensureDefaultStructure:mo,enterCollectionIsolation:Wo,exitCollectionIsolation:Go,flushPendingTransformsNow:We,getPageCellSize:co,getPageGeneration:ls,getSelectionArray:eo,getVisibleElementIds:oo,groupSelectedElements:bs,hitTestPoint:fo,isElementSelected:to,isElementVisible:ro,marqueeSelect:Zo,metrics:ji,moveCollection:Ko,moveLesson:ko,movePage:Co,nudgeSingleToStageDistribution:Xo,patchElement:go,projectData:x,queryElementsAtPoint:rs,queryElementsInRect:os,refitCollection:Ke,renameLesson:So,renameModule:wo,renamePage:xo,reorderLessons:zo,reorderModules:Io,reorderPages:Bo,resetDebugMetrics:Yi,scaleCollection:Uo,selectElement:Je,selectElementFromOutline:Ui,selectPage:To,selectedElementId:J,selectedElementIds:N,selectionBoundingBox:no,setElementPositionDirect:fs,setElementRotation:ho,setElementRotationDirect:Lo,setElementSizeDirect:qo,setSelection:Qn,snapshotDebugMetrics:Fi,toggleElementSelection:Qi,toggleLocked:Do,toggleVisibility:Ho,ungroupCollection:te,updateElementAfterInteraction:jo,updateGroupPositions:Fo,updatePageViewport:so},Symbol.toStringTag,{value:"Module"})),E={left:'<svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 -960 960 960" width="24" fill="currentColor"><path d="M80-80v-800h80v800H80Zm440-200v-400h120v400H520Zm-240 0v-400h120v400H280Z"/></svg>',right:'<svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 -960 960 960" width="24" fill="currentColor"><path d="M800-80v-800h80v800h-80ZM560-280v-400h120v400H560Zm-240 0v-400h120v400H320Z"/></svg>',hcenter:'<svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 -960 960 960" width="24" fill="currentColor"><path d="M80-440v-80h800v80H80Zm200-120v-120h400v120H280Zm0 280v-120h400v120H280Z"/></svg>',vcenter:'<svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 -960 960 960" width="24" fill="currentColor"><path d="M440-80v-800h80v800h-80Zm160-200v-400h120v400H600Zm-360 0v-400h120v400H240Z"/></svg>',top:'<svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 -960 960 960" width="24" fill="currentColor"><path d="M80-800v-80h800v80H80Zm340 640v-560h120v560H420Z"/></svg>',bottom:'<svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 -960 960 960" width="24" fill="currentColor"><path d="M80-80v-80h800v80H80Zm340-160v-560h120v560H420Z"/></svg>',distributeh:'<svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 -960 960 960" width="24" fill="currentColor"><path d="M800-80v-800h80v800h-80ZM80-80v-800h80v800H80Zm520-200v-400h120v400H600Zm-360 0v-400h120v400H240Z"/></svg>',distributev:'<svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 -960 960 960" width="24" fill="currentColor"><path d="M80-800v-80h800v80H80Zm0 720v-80h800v80H80Zm200-520v-120h400v120H280Zm0 360v-120h400v120H280Z"/></svg>',group:'<svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 -960 960 960" width="24" fill="currentColor"><path d="M320-320q33 0 56.5-23.5T400-400q0-33-23.5-56.5T320-480q-33 0-56.5 23.5T240-400q0 33 23.5 56.5T320-320Zm320 0q33 0 56.5-23.5T720-400q0-33-23.5-56.5T640-480q-33 0-56.5 23.5T560-400q0 33 23.5 56.5T640-320ZM480-560q33 0 56.5-23.5T560-640q0-33-23.5-56.5T480-720q-33 0-56.5 23.5T400-640q0 33 23.5 56.5T480-560Zm0 480q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 83-31.5 156T763-197q-54 54-127 85.5T480-80Zm0-80q134 0 227-93t93-227q0-134-93-227t-227-93q-134 0-227 93t-93 227q0 134 93 227t227 93Zm0-320Z"/></svg>',ungroup:'<svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 -960 960 960" width="24" fill="currentColor"><path d="M240-160q-50 0-85-35t-35-85q0-50 35-85t85-35q50 0 85 35t35 85q0 50-35 85t-85 35Zm480 0q-50 0-85-35t-35-85q0-50 35-85t85-35q50 0 85 35t35 85q0 50-35 85t-85 35ZM480-560q-50 0-85-35t-35-85q0-50 35-85t85-35q50 0 85 35t35 85q0 50-35 85t-85 35Z"/></svg>'};var Qo=It('<span class="sep svelte-1tbze1d"></span>'),tr=It('<span class="sep svelte-1tbze1d"></span>'),er=It('<span class="sep svelte-1tbze1d"></span>'),nr=It('<button aria-label="Ungroup collection" class="icon-btn svelte-1tbze1d"><!></button> <!> <button aria-label="Align members left" class="icon-btn svelte-1tbze1d"><!></button> <button aria-label="Align members horizontal center" class="icon-btn svelte-1tbze1d"><!></button> <button aria-label="Align members right" class="icon-btn svelte-1tbze1d"><!></button> <!> <button aria-label="Align members top" class="icon-btn svelte-1tbze1d"><!></button> <button aria-label="Align members vertical center" class="icon-btn svelte-1tbze1d"><!></button> <button aria-label="Align members bottom" class="icon-btn svelte-1tbze1d"><!></button> <!> <button aria-label="Distribute members horizontally" class="icon-btn svelte-1tbze1d"><!></button> <button aria-label="Distribute members vertically" class="icon-btn svelte-1tbze1d"><!></button>',1),sr=It('<button aria-label="Group selection" class="icon-btn svelte-1tbze1d"><!></button>'),ir=It('<span class="sep svelte-1tbze1d"></span>'),or=It('<span class="sep svelte-1tbze1d"></span>'),rr=It('<!> <button aria-label="Align left" class="icon-btn svelte-1tbze1d"><!></button> <button aria-label="Align horizontal center" class="icon-btn svelte-1tbze1d"><!></button> <button aria-label="Align right" class="icon-btn svelte-1tbze1d"><!></button> <!> <button aria-label="Align top" class="icon-btn svelte-1tbze1d"><!></button> <button aria-label="Align vertical center" class="icon-btn svelte-1tbze1d"><!></button> <button aria-label="Align bottom" class="icon-btn svelte-1tbze1d"><!></button> <!> <button aria-label="Distribute horizontally" class="icon-btn svelte-1tbze1d"><!></button> <button aria-label="Distribute vertically" class="icon-btn svelte-1tbze1d"><!></button>',1),ar=It("<div><!></div>");function Ir(t,e){Ys(e,!1);const[n,s]=Zs(),i=()=>Xs(N,"$selectedElementIds",n);let a=Xt(e,"mode",8),r=Xt(e,"singleStageAlign",8,!1),o=Xt(e,"targetCollectionId",8,null),l=Xt(e,"pageScope",8,null),c=Xt(e,"placement",8,"stage");const d=()=>l()||v(L);function f(S){S.stopPropagation(),o()&&te(o())}function u(S){S.stopPropagation(),bs()}function b(S,I){S.stopPropagation(),o()&&gs(o(),I)}function m(S,I){S.stopPropagation(),o()&&ys(o(),I)}function y(S,I){S.stopPropagation(),r()&&i().size===1?ps(d(),I):ms(d(),I)}function p(S,I){S.stopPropagation(),hs(d(),I)}$s();var g=ar();let h;var w=Y(g);{var M=S=>{var I=nr(),_=sn(I),ut=Y(_);G(ut,()=>(X(E),Z(()=>E.ungroup))),F(_),K(_,(C,R)=>z==null?void 0:z(C,R),()=>"Ungroup"),$(()=>W("click",_,f));var Q=H(_,2);{var ot=C=>{var R=Qo();bt(C,R)};Et(Q,C=>{c()==="stage"&&C(ot)})}var B=H(Q,2),D=Y(B);G(D,()=>(X(E),Z(()=>E.left))),F(B),K(B,(C,R)=>z==null?void 0:z(C,R),()=>"Align left"),$(()=>W("click",B,C=>b(C,"left")));var O=H(B,2),et=Y(O);G(et,()=>(X(E),Z(()=>E.hcenter))),F(O),K(O,(C,R)=>z==null?void 0:z(C,R),()=>"Align horizontal center"),$(()=>W("click",O,C=>b(C,"hcenter")));var V=H(O,2),Zt=Y(V);G(Zt,()=>(X(E),Z(()=>E.right))),F(V),K(V,(C,R)=>z==null?void 0:z(C,R),()=>"Align right"),$(()=>W("click",V,C=>b(C,"right")));var ht=H(V,2);{var Pt=C=>{var R=tr();bt(C,R)};Et(ht,C=>{c()==="stage"&&C(Pt)})}var rt=H(ht,2),Nt=Y(rt);G(Nt,()=>(X(E),Z(()=>E.top))),F(rt),K(rt,(C,R)=>z==null?void 0:z(C,R),()=>"Align top"),$(()=>W("click",rt,C=>b(C,"top")));var at=H(rt,2),Rt=Y(at);G(Rt,()=>(X(E),Z(()=>E.vcenter))),F(at),K(at,(C,R)=>z==null?void 0:z(C,R),()=>"Align vertical center"),$(()=>W("click",at,C=>b(C,"vcenter")));var Bt=H(at,2),we=Y(Bt);G(we,()=>(X(E),Z(()=>E.bottom))),F(Bt),K(Bt,(C,R)=>z==null?void 0:z(C,R),()=>"Align bottom"),$(()=>W("click",Bt,C=>b(C,"bottom")));var kt=H(Bt,2);{var Se=C=>{var R=er();bt(C,R)};Et(kt,C=>{c()==="stage"&&C(Se)})}var pt=H(kt,2),xe=Y(pt);G(xe,()=>(X(E),Z(()=>E.distributeh))),F(pt),K(pt,(C,R)=>z==null?void 0:z(C,R),()=>"Distribute horizontally"),$(()=>W("click",pt,C=>m(C,"horizontal")));var k=H(pt,2),P=Y(k);G(P,()=>(X(E),Z(()=>E.distributev))),F(k),K(k,(C,R)=>z==null?void 0:z(C,R),()=>"Distribute vertically"),$(()=>W("click",k,C=>m(C,"vertical"))),bt(S,I)},A=S=>{var I=rr(),_=sn(I);{var ut=k=>{var P=sr(),C=Y(P);G(C,()=>(X(E),Z(()=>E.group))),F(P),K(P,(R,ws)=>z==null?void 0:z(R,ws),()=>"Group (Ctrl+G)"),$(()=>W("click",P,u)),bt(k,P)};Et(_,k=>{c()==="stage"&&k(ut)})}var Q=H(_,2),ot=Y(Q);G(ot,()=>(X(E),Z(()=>E.left))),F(Q),K(Q,(k,P)=>z==null?void 0:z(k,P),()=>"Align left"),$(()=>W("click",Q,k=>y(k,"left")));var B=H(Q,2),D=Y(B);G(D,()=>(X(E),Z(()=>E.hcenter))),F(B),K(B,(k,P)=>z==null?void 0:z(k,P),()=>"Align horizontal center"),$(()=>W("click",B,k=>y(k,"hcenter")));var O=H(B,2),et=Y(O);G(et,()=>(X(E),Z(()=>E.right))),F(O),K(O,(k,P)=>z==null?void 0:z(k,P),()=>"Align right"),$(()=>W("click",O,k=>y(k,"right")));var V=H(O,2);{var Zt=k=>{var P=ir();bt(k,P)};Et(V,k=>{c()==="stage"&&k(Zt)})}var ht=H(V,2),Pt=Y(ht);G(Pt,()=>(X(E),Z(()=>E.top))),F(ht),K(ht,(k,P)=>z==null?void 0:z(k,P),()=>"Align top"),$(()=>W("click",ht,k=>y(k,"top")));var rt=H(ht,2),Nt=Y(rt);G(Nt,()=>(X(E),Z(()=>E.vcenter))),F(rt),K(rt,(k,P)=>z==null?void 0:z(k,P),()=>"Align vertical center"),$(()=>W("click",rt,k=>y(k,"vcenter")));var at=H(rt,2),Rt=Y(at);G(Rt,()=>(X(E),Z(()=>E.bottom))),F(at),K(at,(k,P)=>z==null?void 0:z(k,P),()=>"Align bottom"),$(()=>W("click",at,k=>y(k,"bottom")));var Bt=H(at,2);{var we=k=>{var P=or();bt(k,P)};Et(Bt,k=>{c()==="stage"&&k(we)})}var kt=H(Bt,2),Se=Y(kt);G(Se,()=>(X(E),Z(()=>E.distributeh))),F(kt),K(kt,(k,P)=>z==null?void 0:z(k,P),()=>"Distribute horizontally"),$(()=>W("click",kt,k=>p(k,"horizontal")));var pt=H(kt,2),xe=Y(pt);G(xe,()=>(X(E),Z(()=>E.distributev))),F(pt),K(pt,(k,P)=>z==null?void 0:z(k,P),()=>"Distribute vertically"),$(()=>W("click",pt,k=>p(k,"vertical"))),bt(S,I)};Et(w,S=>{a()==="collection"?S(M):S(A,!1)})}F(g),kn(S=>{Qs(g,1,`unified-toolbar ${c()??""}`,"svelte-1tbze1d"),h=ti(g,"",h,S)},[()=>({transform:c()==="stage"?"translateY(calc(-100% - 10px))":void 0})]),bt(t,g),Fs(),s()}export{So as $,Qi as A,jo as B,Jo as C,ho as D,qo as E,Fo as F,Lo as G,G as H,z as I,Yt as J,wr as K,Ut as L,Sr as M,go as N,Mo as O,Ao as P,Eo as Q,st as R,ft as S,yo as T,Ir as U,Io as V,ko as W,zo as X,Co as Y,bo as Z,wo as _,_t as a,xo as a0,vo as a1,To as a2,Bo as a3,Ui as a4,Po as a5,j as a6,gr as a7,Do as a8,Ho as a9,vr as aa,br as ab,xr as ac,no as b,Ki as c,Je as d,mo as e,Go as f,Qn as g,J as h,bs as i,N as j,Yo as k,fs as l,We as m,$o as n,he as o,x as p,L as q,Qs as r,Le as s,yr as t,pr as u,hr as v,ti as w,mr as x,Wo as y,K as z};
