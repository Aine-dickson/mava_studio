const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["../chunks/CED-4UMh.js","../chunks/nKfqrTNe.js","../chunks/Bzak7iHL.js","../chunks/CLEP_dGz.js","../chunks/CkPp-hAN.js","../assets/UnifiedToolbar.ClrriiDx.css"])))=>i.map(i=>d[i]);
import"../chunks/Bzak7iHL.js";import"../chunks/CLEP_dGz.js";import{q as K,w as He,v as Ne,p as Oe,a as jt,x as O,y as Gt,z as he,A as Fe,i as Q,t as gt,k as V,l as Ve,m as at,n as rt,j as mt,B as Kt,g as i,s as I,C as ge,o as We}from"../chunks/nKfqrTNe.js";import{_ as Ct,s as Et,i as et,b as Ue,a as qe}from"../chunks/CkPp-hAN.js";import{s as ne,t as Me,a as Zt,c as te,b as me,e as Je,d as lt,f as xe,g as Qe,h as _e,i as Ze,p as ot,j as tn,k as Ht,l as bt,m as Jt,n as Nt,o as en,q as J,r as Dt,u as we,v as ye,w as tt,x as nn,y as be,z as sn,U as ze,A as on,B as Rt,C as Ot,D as an,E as ke,F as rn,G as ln}from"../chunks/CED-4UMh.js";const ee=He(null);let Ft=null,zt=null;function At(){const d=K(ne),r=K(te);if(!d||!r){ee.set(null);return}const u=Me.get(d),j=(u==null?void 0:u.time)??0,D=Zt.getForTimeline(d),B=(r.elements??[]).map(L=>L.id),T=new Set;for(const L of B){const P=D.find(W=>W.elementId===L);if(!P){T.add(L);continue}j>=P.start&&j<P.end&&T.add(L)}ee.set(T)}function Ee(){Ft&&(Ft(),Ft=null);const d=K(ne),r=d?Me.get(d):null,u=[];if(r){const B=()=>At();r.on(B),u.push(()=>r.off(B))}zt&&(clearInterval(zt),zt=null),d&&(zt=setInterval(()=>At(),120),u.push(()=>{zt&&(clearInterval(zt),zt=null)}));const j=Zt.subscribe?Zt.subscribe(()=>At()):null;j&&u.push(j);const D=te.subscribe?te.subscribe(()=>At()):null;D&&u.push(D),Ft=()=>u.forEach(B=>B()),At()}ne.subscribe(()=>Ee());Ee();const Qt=(d,r)=>{let u=!1,j=null,D=null;async function B(){j||u||(D||(D=Ct(async()=>{const{default:L}=await import("../chunks/C3Fzcdct.js").then(P=>P.i);return{default:L}},[],import.meta.url).then(({default:L})=>{u||(j=L(d))})),await D)}function T(){if(!j)return;const L=typeof(r==null?void 0:r.drag)=="object"?r.drag:{enabled:!!(r!=null&&r.drag)},P=typeof(r==null?void 0:r.resize)=="object"?r.resize:{enabled:!!(r!=null&&r.resize)};L!=null&&L.enabled?j.draggable({listeners:{start:W=>{var $;return($=L.onStart)==null?void 0:$.call(L,W)},move:W=>{var $;return($=L.onMove)==null?void 0:$.call(L,W)},end:W=>{var $;return($=L.onEnd)==null?void 0:$.call(L,W)}}}):j.draggable&&j.draggable(!1),P!=null&&P.enabled?j.resizable({edges:P.edges??{right:!0,bottom:!0},listeners:{start:W=>{var $;return($=P.onStart)==null?void 0:$.call(P,W)},move:W=>{var $;return($=P.onMove)==null?void 0:$.call(P,W)},end:W=>{var $;return($=P.onEnd)==null?void 0:$.call(P,W)}}}):j.resizable&&j.resizable(!1)}return B().then(T),{update(L){r=L,j?T():B().then(T)},destroy(){var L;u=!0;try{(L=j==null?void 0:j.unset)==null||L.call(j)}catch{}j=null}}};var dn=(d,r)=>{(d.key==="Enter"||d.key===" ")&&(d.preventDefault(),r(d)),d.key==="Escape"&&lt(null)},cn=(d,r,u)=>{d.stopPropagation(),r(d,i(u))},pn=Q("<div></div>"),fn=Q('<div class="selection-overlay svelte-1xzvmt" style="pointer-events:none;"><div class="absolute -top-5 left-2 flex items-center gap-1 text-xs bg-red-600/90 text-white px-2 py-1 rounded shadow svelte-1xzvmt"><svg class="w-3 h-3 svelte-1xzvmt" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" class="svelte-1xzvmt"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4" class="svelte-1xzvmt"></path></svg> <span class="svelte-1xzvmt">Locked</span></div></div>'),vn=(d,r,u)=>r(d,i(u)),un=(d,r,u)=>r(d,i(u),"tl"),hn=(d,r,u)=>r(d,i(u),"tr"),gn=(d,r,u)=>r(d,i(u),"bl"),mn=(d,r,u)=>r(d,i(u),"br"),xn=(d,r,u)=>r(d,i(u),"t"),_n=(d,r,u)=>r(d,i(u),"b"),wn=(d,r,u)=>r(d,i(u),"l"),yn=(d,r,u)=>r(d,i(u),"r"),bn=Q('<div class="selection-overlay svelte-1xzvmt"><span class="rotation-line svelte-1xzvmt"></span> <span class="rotation-handle svelte-1xzvmt" title="Rotate collection (Shift=15Â°, Alt=5Â°, default 1Â°)"><svg viewBox="0 0 24 24" width="12" height="12" stroke="#2563eb" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-1xzvmt"><path d="M4.5 10a7.5 7.5 0 0 1 13.5-4.546" class="svelte-1xzvmt"></path><path d="M19.5 4v5h-5" class="svelte-1xzvmt"></path><path d="M19.5 14a7.5 7.5 0 0 1-13.5 4.546" class="svelte-1xzvmt"></path><path d="M9.5 19h-5v-5" class="svelte-1xzvmt"></path></svg></span> <!> <span class="handle tl svelte-1xzvmt"></span> <span class="handle tr svelte-1xzvmt"></span> <span class="handle bl svelte-1xzvmt"></span> <span class="handle br svelte-1xzvmt"></span> <span class="handle tm svelte-1xzvmt"></span> <span class="handle bm svelte-1xzvmt"></span> <span class="handle ml svelte-1xzvmt"></span> <span class="handle mr svelte-1xzvmt"></span></div>'),zn=Q('<div role="group"><!> <!></div>'),kn=(d,r,u,j,D)=>{if(d.stopPropagation(),!r()&&i(u).parentId){let T=i(u);const L=j().pagesById[D()];for(;T.parentId;){const P=L.elements.find(W=>W.id===T.parentId);if(!P)break;T=P}lt(T.id);return}d.shiftKey?on(i(u).id):lt(i(u).id)},Mn=(d,r)=>{(d.key==="Enter"||d.key===" ")&&(d.preventDefault(),d.stopPropagation(),lt(i(r).id))},En=Q('<div class="absolute top-1 right-1 text-red-600 bg-white/70 rounded p-[2px] leading-none svelte-1xzvmt" style="font-size:10px;">ðŸ”’</div>'),In=(d,r,u)=>r(d,i(u)),$n=(d,r,u)=>r(d,i(u).id,"tl"),Yn=(d,r,u)=>r(d,i(u).id,"tr"),Xn=(d,r,u)=>r(d,i(u).id,"bl"),Ln=(d,r,u)=>r(d,i(u).id,"br"),Bn=(d,r,u)=>r(d,i(u).id,"t"),Dn=(d,r,u)=>r(d,i(u).id,"b"),Rn=(d,r,u)=>r(d,i(u).id,"l"),An=(d,r,u)=>r(d,i(u).id,"r"),Cn=Q('<div class="selection-overlay svelte-1xzvmt"><span class="rotation-line svelte-1xzvmt"></span> <span class="rotation-handle svelte-1xzvmt" title="Rotate (Shift=15Â°, Alt=5Â°, default 1Â°)"><svg viewBox="0 0 24 24" width="12" height="12" stroke="#2563eb" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-1xzvmt"><path d="M4.5 10a7.5 7.5 0 0 1 13.5-4.546" class="svelte-1xzvmt"></path><path d="M19.5 4v5h-5" class="svelte-1xzvmt"></path><path d="M19.5 14a7.5 7.5 0 0 1-13.5 4.546" class="svelte-1xzvmt"></path><path d="M9.5 19h-5v-5" class="svelte-1xzvmt"></path></svg></span> <span class="handle tl svelte-1xzvmt"></span> <span class="handle tr svelte-1xzvmt"></span> <span class="handle bl svelte-1xzvmt"></span> <span class="handle br svelte-1xzvmt"></span> <span class="handle tm svelte-1xzvmt"></span> <span class="handle bm svelte-1xzvmt"></span> <span class="handle ml svelte-1xzvmt"></span> <span class="handle mr svelte-1xzvmt"></span></div>'),Pn=Q('<div role="button" tabindex="0"><div><!> <!></div></div>'),Sn=(d,r)=>r(d,"tl"),Tn=(d,r)=>r(d,"tr"),jn=(d,r)=>r(d,"bl"),Gn=(d,r)=>r(d,"br"),Kn=(d,r)=>r(d,"t"),Hn=(d,r)=>r(d,"b"),Nn=(d,r)=>r(d,"l"),On=(d,r)=>r(d,"r"),Fn=Q('<div class="group-box svelte-1xzvmt"><div class="group-outline svelte-1xzvmt"></div> <div class="group-handle move svelte-1xzvmt" title="Drag group"></div> <span class="rotation-line svelte-1xzvmt" style="top:-18px"></span> <span class="rotation-handle svelte-1xzvmt" title="Rotate selection (Shift=15Â°, Alt=5Â°, default 1Â°)"><svg viewBox="0 0 24 24" width="12" height="12" stroke="#2563eb" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-1xzvmt"><path d="M4.5 10a7.5 7.5 0 0 1 13.5-4.546" class="svelte-1xzvmt"></path><path d="M19.5 4v5h-5" class="svelte-1xzvmt"></path><path d="M19.5 14a7.5 7.5 0 0 1-13.5 4.546" class="svelte-1xzvmt"></path><path d="M9.5 19h-5v-5" class="svelte-1xzvmt"></path></svg></span> <!> <span class="handle tl svelte-1xzvmt"></span> <span class="handle tr svelte-1xzvmt"></span> <span class="handle bl svelte-1xzvmt"></span> <span class="handle br svelte-1xzvmt"></span> <span class="handle tm svelte-1xzvmt"></span> <span class="handle bm svelte-1xzvmt"></span> <span class="handle ml svelte-1xzvmt"></span> <span class="handle mr svelte-1xzvmt"></span></div>'),Vn=Q('<div class="snap-guide v svelte-1xzvmt"></div> <div class="snap-guide v svelte-1xzvmt"></div> <svg class="snap-icon down svelte-1xzvmt" width="15" height="15" viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="m19 9-7 7-7-7" class="svelte-1xzvmt"></path></svg> <svg class="snap-icon up svelte-1xzvmt" width="15" height="15" viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="m5 15 7-7 7 7" class="svelte-1xzvmt"></path></svg>',1),Wn=Q('<div class="snap-guide h svelte-1xzvmt"></div> <div class="snap-guide h svelte-1xzvmt"></div> <svg class="snap-icon right svelte-1xzvmt" width="15" height="15" viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="m9 5 7 7-7 7" class="svelte-1xzvmt"></path></svg> <svg class="snap-icon left svelte-1xzvmt" width="15" height="15" viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="m15 19-7-7 7-7" class="svelte-1xzvmt"></path></svg>',1),Un=Q("<!> <!>",1),qn=Q('<div class="angle-hud svelte-1xzvmt"> </div>'),Jn=Q("<!> <!> <!> <!>",1),Qn=Q('<div role="button" aria-label="Design stage" tabindex="0"><!></div>');function Zn(d,r){Oe(r,!0);const[u,j]=qe(),D=()=>Et(_e,"$selectedElementId",u),B=()=>Et(en,"$activeCollectionId",u),T=()=>Et(tn,"$selectedElementIds",u),L=()=>Et(ot,"$projectData",u),P=()=>Et(J,"$currentPageId",u),W=()=>Et(ee,"$currentAlive",u);let $;function dt(){return K(ot).pagesById[K(J)]}let Ie=Gt(null);jt(()=>{O(Ie,D(),!0)});function ie(n){const e=$.getBoundingClientRect(),p=n.clientX-e.left,o=n.clientY-e.top;let a=!1;if(B()){const v=dt(),f=v==null?void 0:v.elements.find(c=>c.id===B());f&&(p>=f.position.x&&p<=f.position.x+f.size.dimensions.width&&o>=f.position.y&&o<=f.position.y+f.size.dimensions.height||(xe(),a=!0))}(n.target===$||a)&&lt(null)}let U={active:!1,startX:0,startY:0,lastX:0,lastY:0,origBox:null},Z=Gt(he([])),nt=Gt(he({show:!1,text:"",x:0,y:0}));const kt=4;let q={x:!1,y:!1,tx:0,ty:0},G=null,Mt=null,it=null;function Pt(n,e,p,o,a){const v=K(ot).pagesById[n];if(!v)return{x:e,y:p,guides:[]};const f=new Set(Array.from(T())),c=6;let s=null,t=null;const l=e,h=e+o,w=e+o/2,b=p,z=p+a,M=p+a/2,X=($==null?void 0:$.clientWidth)??0,E=($==null?void 0:$.clientHeight)??0;function m(_,y,k,Y){Math.abs(y)<=c&&(!s||Math.abs(y)<Math.abs(s.adjust))&&(s={target:_,adjust:y,from:k,to:Y})}function g(_,y,k,Y){Math.abs(y)<=c&&(!t||Math.abs(y)<Math.abs(t.adjust))&&(t={target:_,adjust:y,from:k,to:Y})}for(const _ of v.elements){if(f.has(_.id))continue;const y=_.position.x,k=_.position.y,Y=_.size.dimensions.width,R=_.size.dimensions.height,C=[y,y+Y/2,y+Y];for(const S of C)m(S,S-l,k,k+R),m(S,S-w,k,k+R),m(S,S-h,k,k+R);const A=[k,k+R/2,k+R];for(const S of A)g(S,S-b,y,y+Y),g(S,S-M,y,y+Y),g(S,S-z,y,y+Y)}!s&&X&&(m(0,0-l,0,E),m(X/2,X/2-w,0,E),m(X,X-h,0,E)),!t&&E&&(g(0,0-b,0,X),g(E/2,E/2-M,0,X),g(E,E-z,0,X)),s&&(e+=s.adjust),t&&(p+=t.adjust);const x=[];return s&&x.push({type:"v",pos:s.target,gap:[p,p+a],from:s.from,to:s.to}),t&&x.push({type:"h",pos:t.target,gap:[e,e+o],from:t.from,to:t.to}),{x:e,y:p,guides:x}}function $e(n){if(T().size<2)return;const e=K(J),p=K(ot).pagesById[e];Array.from(T()).some(o=>{const a=p.elements.find(v=>v.id===o);return a==null?void 0:a.locked})||(n.altKey&&Ct(()=>import("../chunks/CED-4UMh.js").then(o=>o.ac),__vite__mapDeps([0,1,2,3,4,5]),import.meta.url).then(o=>{const a=K(J);o.duplicateSelectionForDrag(a)}),U.active=!0,U.startX=n.clientX,U.startY=n.clientY,U.lastX=n.clientX,U.lastY=n.clientY,U.origBox=i(H)&&{...i(H)},q={x:!1,y:!1,tx:0,ty:0},Ht(),window.addEventListener("pointermove",se),window.addEventListener("pointerup",Ye,{once:!0}))}function se(n){if(!U.active||!i(H)||!U.origBox)return;const e=n.clientX-U.startX,p=n.clientY-U.startY,o=U.origBox.x+e,a=U.origBox.y+p,v=Pt(K(J),o,a,U.origBox.width,U.origBox.height);let f=o,c=a;const s=6,t=v.guides.find(z=>z.type==="v"),l=v.guides.find(z=>z.type==="h");if(t){const z=v.x-o;!q.x&&Math.abs(z)<=s&&(q.x=!0,q.tx=v.x)}if(q.x&&(Math.abs(o-q.tx)>s+kt?q.x=!1:f=q.tx),l){const z=v.y-a;!q.y&&Math.abs(z)<=s&&(q.y=!0,q.ty=v.y)}q.y&&(Math.abs(a-q.ty)>s+kt?q.y=!1:c=q.ty);const h=[];q.x&&t&&h.push(t),q.y&&l&&h.push(l);const w=f-i(H).x,b=c-i(H).y;(w||b)&&rn(w,b),O(H,{...i(H),x:f,y:c},!0),O(Z,h,!0)}function Ye(){U.active&&(U.active=!1,O(Z,[],!0),Nt(),window.removeEventListener("pointermove",se))}function oe(n,e){B()||(G={id:e.id,startX:n.clientX,startY:n.clientY,origX:e.position.x,origY:e.position.y,snap:{x:!1,y:!1,tx:0,ty:0}},window.addEventListener("pointermove",ae),window.addEventListener("pointerup",Xe,{once:!0}),Ot(e.id))}function ae(n){if(!G)return;const e=K(J),p=K(ot).pagesById[e];if(!p)return;const o=p.elements.find(b=>b.id===G.id);if(!o)return;const a=G.origX+(n.clientX-G.startX),v=G.origY+(n.clientY-G.startY),f=Pt(e,a,v,o.size.dimensions.width,o.size.dimensions.height),c=6,s=f.guides.find(b=>b.type==="v"),t=f.guides.find(b=>b.type==="h");let l=a,h=v;if(s){const b=f.x-a;!G.snap.x&&Math.abs(b)<=c&&(G.snap.x=!0,G.snap.tx=f.x)}if(G.snap.x&&(Math.abs(a-G.snap.tx)>c+kt?G.snap.x=!1:l=G.snap.tx),t){const b=f.y-v;!G.snap.y&&Math.abs(b)<=c&&(G.snap.y=!0,G.snap.ty=f.y)}G.snap.y&&(Math.abs(v-G.snap.ty)>c+kt?G.snap.y=!1:h=G.snap.ty);const w=[];G.snap.x&&s&&w.push(s),G.snap.y&&t&&w.push(t),O(Z,w,!0),bt(o.id,l,h)}function Xe(){G&&(Rt(G.id),G=null,O(Z,[],!0),window.removeEventListener("pointermove",ae))}function ct(n,e){if(T().size<2||!i(H))return;n.stopPropagation(),U.active=!1,Ht();const p=K(J),o=K(ot).pagesById[p];if(!o)return;const v=Array.from(T()).map(f=>{const c=o.elements.find(s=>s.id===f);return c?{id:f,x:c.position.x,y:c.position.y,w:c.size.dimensions.width,h:c.size.dimensions.height}:null}).filter(Boolean);Mt={dir:e,startX:n.clientX,startY:n.clientY,origBox:{...i(H)},elems:v},window.addEventListener("pointermove",re),window.addEventListener("pointerup",Le,{once:!0})}function re(n){if(!Mt)return;const{dir:e,startX:p,startY:o,origBox:a}=Mt;let v=n.clientX-p,f=n.clientY-o,c=a.x,s=a.y,t=a.width,l=a.height;const h=10;if(e.includes("l")&&(c=a.x+v,t=a.width-v),e.includes("r")&&(t=a.width+v),e.includes("t")&&(s=a.y+f,l=a.height-f),e.includes("b")&&(l=a.height+f),t<h){const m=h-t;t=h,e.includes("l")&&(c-=m)}if(l<h){const m=h-l;l=h,e.includes("t")&&(s-=m)}const w=K(J),b=K(ot).pagesById[w],z=6;let M=[];if(b){const m=new Set(Array.from(T())),g=b.elements.filter(x=>!m.has(x.id));if(e.includes("l")||e.includes("r")){let x=null;const _=e.includes("l"),y=c,k=c+t;for(const Y of g){const R=Y.position.x,C=Y.size.dimensions.width;for(const A of[R,R+C/2,R+C])if(_){const S=Math.abs(A-y);S<=z&&(!x||S<Math.abs(x.delta))&&(x={edge:"l",target:A,delta:A-y})}else{const S=Math.abs(A-k);S<=z&&(!x||S<Math.abs(x.delta))&&(x={edge:"r",target:A,delta:A-k})}}if(x){if(x.edge==="l"){const Y=c+t;c=x.target,t=Y-c}else t=x.target-c;M.push({type:"v",pos:x.target,gap:[s,s+l],from:0,to:($==null?void 0:$.clientHeight)??s+l})}}if(e.includes("t")||e.includes("b")){let x=null;const _=e.includes("t"),y=s,k=s+l;for(const Y of g){const R=Y.position.y,C=Y.size.dimensions.height;for(const A of[R,R+C/2,R+C])if(_){const S=Math.abs(A-y);S<=z&&(!x||S<Math.abs(x.delta))&&(x={edge:"t",target:A,delta:A-y})}else{const S=Math.abs(A-k);S<=z&&(!x||S<Math.abs(x.delta))&&(x={edge:"b",target:A,delta:A-k})}}if(x){if(x.edge==="t"){const Y=s+l;s=x.target,l=Y-s}else l=x.target-s;M.push({type:"h",pos:x.target,gap:[c,c+t],from:0,to:($==null?void 0:$.clientWidth)??c+t})}}}O(Z,M,!0),O(H,{x:Math.round(c),y:Math.round(s),width:Math.round(t),height:Math.round(l)},!0);const X=a.width===0?1:t/a.width,E=a.height===0?1:l/a.height;e.includes("l"),e.includes("t");for(const m of Mt.elems){const g=(m.x-a.x)/(a.width||1),x=(m.y-a.y)/(a.height||1);let _=c+g*t,y=s+x*l;const k=Math.max(2,Math.round(m.w*X)),Y=Math.max(2,Math.round(m.h*E));bt(m.id,Math.round(_),Math.round(y)),ke(m.id,k,Y)}}function Le(){Mt&&(Jt(),K(J),Nt(),Mt=null,O(Z,[],!0),window.removeEventListener("pointermove",re))}let H=Gt(null);jt(()=>{L(),T().size>1?O(H,me(K(J)),!0):O(H,null)});function le(n){const e=dt();if(!e)return;if((n.ctrlKey||n.metaKey)&&n.key.toLowerCase()==="a"){const f=e.elements.filter(c=>!c.locked).map(c=>c.id);f.length&&(Qe(f),_e.set(f[f.length-1]),O(H,me(K(J)),!0)),n.preventDefault(),n.stopPropagation();return}if(n.key==="Escape"&&B()){xe(),n.preventDefault();return}if((n.ctrlKey||n.metaKey)&&n.key.toLowerCase()==="g"){T().size>1&&Ze(),n.preventDefault(),n.stopPropagation();return}if(T().size===0)return;const p=Array.from(T());D();let o=(n.shiftKey?10:1)*(n.ctrlKey||n.metaKey?2:1),a=!1;const v=(f,c)=>{if(!(!f&&!c)){Ht();for(const s of p){const t=e.elements.find(l=>l.id===s);t&&bt(s,t.position.x+f,t.position.y+c)}Jt(),Nt(),a=!0}};switch(n.key){case"ArrowLeft":v(-o,0);break;case"ArrowRight":v(o,0);break;case"ArrowUp":v(0,-o);break;case"ArrowDown":v(0,o);break;case"Delete":case"Backspace":Ct(()=>import("../chunks/CED-4UMh.js").then(f=>f.ac),__vite__mapDeps([0,1,2,3,4,5]),import.meta.url).then(f=>{f.deleteElements(p)}),a=!0;break}a&&(n.preventDefault(),n.stopPropagation())}typeof window<"u"&&(window.addEventListener("keydown",le),Fe(()=>window.removeEventListener("keydown",le)));const Be=n=>{let e={x:0,y:0},p={w:0,h:0},o={x:!1,y:!1,tx:0,ty:0},a=!1,v=null;function f(){var t,l,h,w;const c=dt(),s=c==null?void 0:c.elements.find(b=>b.id===n);if(!s)return!1;if(lt(n),B()){let b=s,z=!1;for(;b.parentId;){if(b.parentId===B()){z=!0;break}const M=c==null?void 0:c.elements.find(X=>X.id===b.parentId);if(!M)break;b=M}if(z){const M=c==null?void 0:c.elements.find(m=>m.id===B());v={x:M.position.x,y:M.position.y};const X=M.position.x+s.position.x,E=M.position.y+s.position.y;e={x:X,y:E}}else{const M=Number((t=s.position)==null?void 0:t.x)||0,X=Number((l=s.position)==null?void 0:l.y)||0;e={x:M,y:X}}}else{const b=Number((h=s.position)==null?void 0:h.x)||0,z=Number((w=s.position)==null?void 0:w.y)||0;e={x:b,y:z}}return p={w:s.size.dimensions.width,h:s.size.dimensions.height},a=!0,!0}return{onStart:c=>{if(f()){c!=null&&c.altKey&&Ct(()=>import("../chunks/CED-4UMh.js").then(l=>l.ac),__vite__mapDeps([0,1,2,3,4,5]),import.meta.url).then(l=>{const h=K(J);l.duplicateSelectionForDrag(h)});const s=dt(),t=s==null?void 0:s.elements.find(l=>l.id===n);if(t!=null&&t.locked)return;Ot(n)}},onMove:c=>{a||f();const s=dt(),t=s==null?void 0:s.elements.find(E=>E.id===n);if(t!=null&&t.locked)return;e={x:e.x+(c.dx??0),y:e.y+(c.dy??0)};const l=Pt(K(J),e.x,e.y,p.w,p.h),h=6,w=l.guides.find(E=>E.type==="v"),b=l.guides.find(E=>E.type==="h");let z=e.x,M=e.y;if(w){const E=l.x-e.x;!o.x&&Math.abs(E)<=h&&(o.x=!0,o.tx=l.x)}if(o.x&&(Math.abs(e.x-o.tx)>h+kt?o.x=!1:z=o.tx),b){const E=l.y-e.y;!o.y&&Math.abs(E)<=h&&(o.y=!0,o.ty=l.y)}o.y&&(Math.abs(e.y-o.ty)>h+kt?o.y=!1:M=o.ty);const X=[];o.x&&w&&X.push(w),o.y&&b&&X.push(b),O(Z,X,!0),v?bt(n,z-v.x,M-v.y):bt(n,z,M)},onEnd:()=>{Rt(n),O(Z,[],!0)}}};function Vt(n){if(!n)return{x:0,y:0};let e=n.position.x,p=n.position.y,o=n;const a=dt();let v=0;for(;o.parentId&&v<10;){const f=a==null?void 0:a.elements.find(c=>c.id===o.parentId);if(!f)break;e+=f.position.x,p+=f.position.y,o=f,v++}return{x:e,y:p}}let St=null,xt=null;const De=320,Wt=6;let It=null,_t=null;function Re(n,e){if(B())return;lt(e.id);const p=performance.now();if(It&&(clearTimeout(It),It=null),xt&&xt.id===e.id&&p-xt.time<De){const o=n.clientX-xt.x,a=n.clientY-xt.y;if(Math.hypot(o,a)<=Wt){if(e.locked)return;It=setTimeout(()=>{be(e.id),It=null},0)}else xt={id:e.id,time:p,x:n.clientX,y:n.clientY},oe(n,e)}else{xt={id:e.id,time:p,x:n.clientX,y:n.clientY};let o=!1;const a=f=>{if(!o&&(Math.abs(f.clientX-n.clientX)>Wt||Math.abs(f.clientY-n.clientY)>Wt)){if(e.locked){o=!0;return}o=!0,oe(f,e)}},v=()=>{window.removeEventListener("pointermove",a),window.removeEventListener("pointerup",v)};window.addEventListener("pointermove",a),window.addEventListener("pointerup",v,{once:!0})}}function pt(n,e,p){n.stopPropagation(),St={id:e.id,dir:p,startX:n.clientX,startY:n.clientY,orig:{x:e.position.x,y:e.position.y,w:e.size.dimensions.width,h:e.size.dimensions.height}},window.addEventListener("pointermove",de),window.addEventListener("pointerup",Ae,{once:!0})}function de(n){if(!St)return;const{id:e,dir:p,startX:o,startY:a,orig:v}=St;let f=n.clientX-o,c=n.clientY-a,s=v.x,t=v.y,l=v.w,h=v.h;const w=20;if(p.includes("l")&&(s=v.x+f,l=v.w-f),p.includes("r")&&(l=v.w+f),p.includes("t")&&(t=v.y+c,h=v.h-c),p.includes("b")&&(h=v.h+c),l<w){const _=w-l;l=w,p.includes("l")&&(s-=_)}if(h<w){const _=w-h;h=w,p.includes("t")&&(t-=_)}const b=K(J),z=Pt(b,s,t,l,h),M=6,X=z.guides.find(_=>_.type==="v"),E=z.guides.find(_=>_.type==="h");let m=!1,g=!1;if(X&&Math.abs(z.x-s)<=M&&(m=!0),E&&Math.abs(z.y-t)<=M&&(g=!0),m)if(p.includes("l")){const _=s+l;s=z.x,l=_-s}else p.includes("r")||(s=z.x);if(g)if(p.includes("t")){const _=t+h;t=z.y,h=_-t}else p.includes("b")||(t=z.y);const x=[];m&&X&&x.push(X),g&&E&&x.push(E),O(Z,x,!0),Ct(()=>import("../chunks/CED-4UMh.js").then(_=>_.ac),__vite__mapDeps([0,1,2,3,4,5]),import.meta.url).then(_=>{_.scaleCollection(e,l,h,s,t,!1)})}function Ae(){St=null,D()&&Rt(D()),window.removeEventListener("pointermove",de),O(Z,[],!0)}let ft=null;function vt(n,e,p){if(T().size>1)return;n.stopPropagation();const o=dt(),a=o==null?void 0:o.elements.find(s=>s.id===e);if(!a)return;lt(e);let v=a.position.x,f=a.position.y,c=null;if(B()){let s=a;for(;s.parentId&&s.parentId!==B();){const t=o==null?void 0:o.elements.find(l=>l.id===s.parentId);if(!t)break;s=t}if(s.parentId===B()){const t=o==null?void 0:o.elements.find(l=>l.id===B());c={x:t.position.x,y:t.position.y},v=t.position.x+a.position.x,f=t.position.y+a.position.y}}ft={id:e,dir:p,startX:n.clientX,startY:n.clientY,orig:{x:v,y:f,w:a.size.dimensions.width,h:a.size.dimensions.height}},ft.parentAbs=c,O(Z,[],!0),Ot(e),window.addEventListener("pointermove",ce),window.addEventListener("pointerup",Ce,{once:!0})}function ce(n){if(!ft)return;const{dir:e,startX:p,startY:o,orig:a,id:v}=ft;let f=n.clientX-p,c=n.clientY-o,s=a.x,t=a.y,l=a.w,h=a.h;const w=20;if(e.includes("l")&&(s=a.x+f,l=a.w-f),e.includes("r")&&(l=a.w+f),e.includes("t")&&(t=a.y+c,h=a.h-c),e.includes("b")&&(h=a.h+c),l<w){const m=w-l;l=w,e.includes("l")&&(s-=m)}if(h<w){const m=w-h;h=w,e.includes("t")&&(t-=m)}const b=K(J),z=K(ot).pagesById[b],M=6;let X=[];if(z){const m=z.elements.filter(g=>g.id!==v);if(e.includes("l")||e.includes("r")){let g=null;const x=e.includes("l"),_=s,y=s+l;for(const k of m){const Y=k.position.x,R=k.size.dimensions.width;for(const C of[Y,Y+R/2,Y+R])if(x){const A=Math.abs(C-_);A<=M&&(!g||A<Math.abs(g.delta))&&(g={edge:"l",target:C,delta:C-_})}else{const A=Math.abs(C-y);A<=M&&(!g||A<Math.abs(g.delta))&&(g={edge:"r",target:C,delta:C-y})}}if(g){if(g.edge==="l"){const k=s+l;s=g.target,l=k-s}else l=g.target-s;X.push({type:"v",pos:g.target,gap:[t,t+h],from:0,to:($==null?void 0:$.clientHeight)??t+h})}}if(e.includes("t")||e.includes("b")){let g=null;const x=e.includes("t"),_=t,y=t+h;for(const k of m){const Y=k.position.y,R=k.size.dimensions.height;for(const C of[Y,Y+R/2,Y+R])if(x){const A=Math.abs(C-_);A<=M&&(!g||A<Math.abs(g.delta))&&(g={edge:"t",target:C,delta:C-_})}else{const A=Math.abs(C-y);A<=M&&(!g||A<Math.abs(g.delta))&&(g={edge:"b",target:C,delta:C-y})}}if(g){if(g.edge==="t"){const k=t+h;t=g.target,h=k-t}else h=g.target-t;X.push({type:"h",pos:g.target,gap:[s,s+l],from:0,to:($==null?void 0:$.clientWidth)??s+l})}}}if(l<w){const m=w-l;e.includes("l")&&(s-=m),l=w}if(h<w){const m=w-h;e.includes("t")&&(t-=m),h=w}O(Z,X,!0);const E=ft.parentAbs;E?bt(v,Math.round(s-E.x),Math.round(t-E.y)):bt(v,Math.round(s),Math.round(t)),ke(v,Math.round(l),Math.round(h))}function Ce(){ft&&(Rt(ft.id),ft=null,O(Z,[],!0),window.removeEventListener("pointermove",ce))}jt(()=>{Je()});let ut=null;function Ut(n,e,p,o){return(Math.atan2(o-e,p-n)*180/Math.PI+360)%360}function pe(n,e){const p=e.shiftKey?15:e.altKey?5:1;return Math.round(n/p)*p}function fe(n,e){if(n.stopPropagation(),e.locked)return;const p=Vt(e),o={x:p.x+e.size.dimensions.width/2,y:p.y+e.size.dimensions.height/2};ut={id:e.id,center:o,startRotation:e.rotation||0},Ot(e.id),window.addEventListener("pointermove",ve),window.addEventListener("pointerup",Pe,{once:!0})}function ve(n){if(!ut)return;const e=ut.id,p=K(J),o=K(ot).pagesById[p];if(!o||!o.elements.find(c=>c.id===e))return;const v=Ut(ut.center.x,ut.center.y,n.clientX,n.clientY),f=pe(v,n);an(p,e,f),O(nt,{show:!0,text:`${f}Â°`,x:n.clientX+12,y:n.clientY-28},!0)}function Pe(){ut&&(Rt(ut.id),ut=null,window.removeEventListener("pointermove",ve),O(nt,{...i(nt),show:!1},!0))}function Se(n){if(T().size<2||!i(H))return;n.stopPropagation();const e={x:i(H).x+i(H).width/2,y:i(H).y+i(H).height/2},p=Array.from(T()),o=dt();if(!o)return;const a={};for(const v of p){const f=o.elements.find(c=>c.id===v);if(!f||f.locked)return;a[v]=f.rotation||0}it={center:e,startAngle:Ut(e.x,e.y,n.clientX,n.clientY),initial:a,ids:p},Ht(),window.addEventListener("pointermove",ue),window.addEventListener("pointerup",Te,{once:!0})}function ue(n){if(!it)return;let p=Ut(it.center.x,it.center.y,n.clientX,n.clientY)-it.startAngle;p=(p+540)%360-180;const o=pe(p,n);for(const v of it.ids){const f=it.initial[v]||0;ln(v,f+o)}const a=o>0?"+":"";O(nt,{show:!0,text:`Î” ${a}${o}Â°`,x:n.clientX+12,y:n.clientY-28},!0)}function Te(){it&&(Jt(),Nt(),it=null,window.removeEventListener("pointermove",ue),O(nt,{...i(nt),show:!1},!0))}jt(()=>{B()&&_t?(D()!==_t&&lt(_t),D()===_t&&(_t=null)):B()||(_t=null)});var wt=Qn();wt.__click=ie,wt.__keydown=[dn,ie];var je=at(wt);{var Ge=n=>{var e=Jn(),p=mt(e);we(p,1,()=>L().pagesById[P()].elements,ye,(s,t)=>{var l=Kt(),h=mt(l);{var w=b=>{var z=Kt(),M=mt(z);{var X=m=>{var g=zn();g.__pointerdown=[cn,Re,t];let x;var _=at(g);{var y=R=>{var C=pn();gt(()=>Dt(C,1,`collection-frame ${B()===i(t).id&&D()&&D()!==i(t).id?"active":""}`,"svelte-1xzvmt")),V(R,C)};et(_,R=>{(!B()&&D()===i(t).id||B()===i(t).id)&&R(y)})}var k=I(_,2);{var Y=R=>{var C=Kt(),A=mt(C);{var S=N=>{var F=fn();V(N,F)},qt=N=>{var F=bn(),st=I(at(F),2);st.__pointerdown=[vn,fe,t];var ht=I(st,2);ze(ht,{mode:"collection",get targetCollectionId(){return D()}});var yt=I(ht,2);yt.__pointerdown=[un,pt,t];var $t=I(yt,2);$t.__pointerdown=[hn,pt,t];var Yt=I($t,2);Yt.__pointerdown=[gn,pt,t];var Xt=I(Yt,2);Xt.__pointerdown=[mn,pt,t];var Lt=I(Xt,2);Lt.__pointerdown=[xn,pt,t];var Bt=I(Lt,2);Bt.__pointerdown=[_n,pt,t];var Tt=I(Bt,2);Tt.__pointerdown=[wn,pt,t];var Ke=I(Tt,2);Ke.__pointerdown=[yn,pt,t],rt(F),V(N,F)};et(A,N=>{i(t).locked?N(S):N(qt,!1)})}V(R,C)};et(k,R=>{D()===i(t).id&&!B()&&R(Y)})}rt(g),gt(R=>{Dt(g,1,`absolute collection-container ${B()&&B()!==i(t).id?"dim-outside":""}`,"svelte-1xzvmt"),x=tt(g,"",x,R)},[()=>({"pointer-events":B()===i(t).id?"none":"auto",transform:`translate(${i(t).position.x}px, ${i(t).position.y}px)`,width:`${i(t).size.dimensions.width}px`,height:`${i(t).size.dimensions.height}px`})]),V(m,g)},E=m=>{var g=Kt(),x=mt(g);nn(x,()=>i(t).id,_=>{var y=Pn();y.__click=[kn,B,t,L,P],y.__dblclick=N=>{if(N.stopPropagation(),i(t).parentId&&!B()){let F=i(t);const st=L().pagesById[P()];for(;F.parentId;){const ht=st.elements.find(yt=>yt.id===F.parentId);if(!ht)break;F=ht}if(F.locked)return;_t=i(t).id,be(F.id,i(t).id)}},y.__keydown=[Mn,t];let k;var Y=at(y);let R;var C=at(Y);{var A=N=>{var F=En();V(N,F)};et(C,N=>{D()===i(t).id&&i(t).locked&&N(A)})}var S=I(C,2);{var qt=N=>{var F=Cn(),st=I(at(F),2);st.__pointerdown=[In,fe,t];var ht=I(st,2);ht.__pointerdown=[$n,vt,t];var yt=I(ht,2);yt.__pointerdown=[Yn,vt,t];var $t=I(yt,2);$t.__pointerdown=[Xn,vt,t];var Yt=I($t,2);Yt.__pointerdown=[Ln,vt,t];var Xt=I(Yt,2);Xt.__pointerdown=[Bn,vt,t];var Lt=I(Xt,2);Lt.__pointerdown=[Dn,vt,t];var Bt=I(Lt,2);Bt.__pointerdown=[Rn,vt,t];var Tt=I(Bt,2);Tt.__pointerdown=[An,vt,t],rt(F),V(N,F)};et(S,N=>{D()===i(t).id&&!i(t).locked&&N(qt)})}rt(Y),rt(y),sn(y,(N,F)=>Qt==null?void 0:Qt(N,F),()=>({drag:{enabled:!0,...Be(i(t).id)}})),gt((N,F,st)=>{Dt(y,1,`absolute cursor-move ${D()===i(t).id&&!i(t).visible?"hidden-pulse":""}`,"svelte-1xzvmt"),k=tt(y,"",k,N),Dt(Y,1,`w-full h-full relative border rounded shadow-sm ${i(t).appliedClasses??""??""} ${F??""}`,"svelte-1xzvmt"),R=tt(Y,"",R,st)},[()=>({transform:`translate(${Vt(i(t)).x}px, ${Vt(i(t)).y}px)`,width:`${i(t).size.dimensions.width}px`,height:`${i(t).size.dimensions.height}px`,cursor:i(t).locked?"default":"move",outline:D()===i(t).id?i(t).locked?"2px solid #dc2626":i(t).visible?void 0:"2px dashed rgba(59,130,246,0.55)":void 0,"box-shadow":D()===i(t).id&&!i(t).visible?"0 0 0 2px rgba(59,130,246,0.2), 0 0 0 4px rgba(59,130,246,0.12)":void 0,"background-color":D()===i(t).id&&!i(t).visible?"rgba(59,130,246,0.08)":void 0}),()=>T().has(i(t).id)?"ring-2 ring-blue-500/90 ring-offset-1 ring-offset-transparent":"",()=>{var N;return{background:String(((N=i(t).style)==null?void 0:N.fillColor)??"#60a5fa"),transform:`rotate(${i(t).rotation||0}deg)`,"transform-origin":"center center"}}]),V(_,y)}),V(m,g)};et(M,m=>{i(t).type==="collection"?m(X):m(E,!1)})}V(b,z)};et(h,b=>{i(t).visible!==!1&&(W()===null||W().has(i(t).id))&&b(w)})}V(s,l)});var o=I(p,2);{var a=s=>{var t=Fn();t.__pointerdown=$e;let l;var h=I(at(t),6);h.__pointerdown=Se;var w=I(h,2);{let _=ge(()=>{var k;return D()&&((k=L().pagesById[P()].elements.find(Y=>Y.id===D()))==null?void 0:k.type)==="collection"?"collection":"multiselect"}),y=ge(()=>{var k;return D()&&((k=L().pagesById[P()].elements.find(Y=>Y.id===D()))==null?void 0:k.type)==="collection"?D():null});ze(w,{get mode(){return i(_)},get targetCollectionId(){return i(y)}})}var b=I(w,2);b.__pointerdown=[Sn,ct];var z=I(b,2);z.__pointerdown=[Tn,ct];var M=I(z,2);M.__pointerdown=[jn,ct];var X=I(M,2);X.__pointerdown=[Gn,ct];var E=I(X,2);E.__pointerdown=[Kn,ct];var m=I(E,2);m.__pointerdown=[Hn,ct];var g=I(m,2);g.__pointerdown=[Nn,ct];var x=I(g,2);x.__pointerdown=[On,ct],rt(t),gt(_=>l=tt(t,"",l,_),[()=>({transform:`translate(${i(H).x}px, ${i(H).y}px)`,width:`${i(H).width}px`,height:`${i(H).height}px`})]),V(s,t)};et(o,s=>{i(H)&&s(a)})}var v=I(o,2);we(v,17,()=>i(Z),ye,(s,t)=>{var l=Un(),h=mt(l);{var w=M=>{var X=Vn(),E=mt(X),m=I(E,2),g=I(m,2),x=I(g,2);gt(_=>{tt(E,_),tt(m,`left:${i(t).pos}px; top:${i(t).gap[1]}px; bottom:0`),tt(g,`left:${i(t).pos-7.5}px; top:${i(t).gap[0]-14}px`),tt(x,`left:${i(t).pos-7.5}px; top:${i(t).gap[1]-3}px`)},[()=>`left:${i(t).pos}px; top:0; height:${Math.max(0,i(t).gap[0])}px`]),V(M,X)};et(h,M=>{i(t).type==="v"&&M(w)})}var b=I(h,2);{var z=M=>{var X=Wn(),E=mt(X),m=I(E,2),g=I(m,2),x=I(g,2);gt(_=>{tt(E,_),tt(m,`top:${i(t).pos}px; left:${i(t).gap[1]}px; right:0`),tt(g,`top:${i(t).pos-7.5}px; left:${i(t).gap[0]-14}px`),tt(x,`top:${i(t).pos-7.5}px; left:${i(t).gap[1]-3}px`)},[()=>`top:${i(t).pos}px; left:0; width:${Math.max(0,i(t).gap[0])}px`]),V(M,X)};et(b,M=>{i(t).type==="h"&&M(z)})}V(s,l)});var f=I(v,2);{var c=s=>{var t=qn(),l=at(t,!0);rt(t),gt(()=>{tt(t,`left:${i(nt).x}px; top:${i(nt).y}px;`),We(l,i(nt).text)}),V(s,t)};et(f,s=>{i(nt).show&&s(c)})}V(n,e)};et(je,n=>{L().pagesById[P()]&&n(Ge)})}rt(wt),Ue(wt,n=>$=n,()=>$),gt(()=>Dt(wt,1,`relative w-full h-full grid-bg outline-none text-left ${B()?"isolation-mode":""}`,"svelte-1xzvmt")),V(d,wt),Ve(),j()}Ne(["click","keydown","pointerdown","dblclick"]);var ti=Q('<div class="h-full"><!></div>');function ai(d){var r=ti(),u=at(r);Zn(u,{}),rt(r),V(d,r)}export{ai as component};
